{"ast":null,"code":"// Generated by IcedCoffeeScript 108.0.8\n(function () {\n  var ADRBG, DRBG, Lock, WordArray, XOR, hmac, iced, sha3, sha512, __iced_k, __iced_k_noop;\n\n  iced = require('iced-runtime');\n\n  __iced_k = __iced_k_noop = function () {};\n\n  hmac = require('./hmac');\n  XOR = require('./combine').XOR;\n  sha512 = require('./sha512');\n  sha3 = require('./sha3');\n  WordArray = require('./wordarray').WordArray;\n  Lock = require('iced-lock').Lock;\n\n  DRBG = function () {\n    function DRBG(entropy, personalization_string, hmac_func) {\n      this.hmac = hmac_func || hmac.sign;\n      this.security_strength = 256;\n      entropy = this.check_entropy(entropy);\n      personalization_string || (personalization_string = new WordArray([]));\n\n      this._instantiate(entropy, personalization_string);\n    }\n\n    DRBG.prototype.check_entropy = function (entropy, reseed) {\n      if (reseed == null) {\n        reseed = false;\n      }\n\n      if (entropy.sigBytes * 8 * 2 < (reseed ? 2 : 3) * this.security_strength) {\n        throw new Error(\"entropy must be at least \" + 1.5 * this.security_strength + \" bits.\");\n      }\n\n      return entropy;\n    };\n\n    DRBG.prototype._hmac = function (key, input) {\n      return this.hmac({\n        key: key,\n        input: input\n      });\n    };\n\n    DRBG.prototype._update = function (provided_data) {\n      var V, V_in;\n      V = new WordArray([0], 1);\n\n      if (provided_data != null) {\n        V = V.concat(provided_data);\n      }\n\n      V_in = this.V.clone().concat(V);\n      this.K = this._hmac(this.K, V_in);\n      V_in.scrub();\n      V.scrub();\n      this.V = this._hmac(this.K, this.V);\n\n      if (provided_data != null) {\n        V_in = this.V.clone().concat(new WordArray([1 << 24], 1)).concat(provided_data);\n        this.K = this._hmac(this.K, V_in);\n        V_in.scrub();\n        this.V = this._hmac(this.K, this.V);\n      }\n\n      return provided_data != null ? provided_data.scrub() : void 0;\n    };\n\n    DRBG.prototype._instantiate = function (entropy, personalization_string) {\n      var i, n, seed_material;\n      seed_material = entropy.concat(personalization_string);\n      n = 64;\n      this.K = WordArray.from_buffer(new Buffer(function () {\n        var _i, _results;\n\n        _results = [];\n\n        for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {\n          _results.push(0);\n        }\n\n        return _results;\n      }()));\n      this.V = WordArray.from_buffer(new Buffer(function () {\n        var _i, _results;\n\n        _results = [];\n\n        for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {\n          _results.push(1);\n        }\n\n        return _results;\n      }()));\n\n      this._update(seed_material);\n\n      entropy.scrub();\n      return this.reseed_counter = 1;\n    };\n\n    DRBG.prototype.reseed = function (entropy) {\n      this._update(this.check_entropy(entropy, true));\n\n      return this.reseed_counter = 1;\n    };\n\n    DRBG.prototype.generate = function (num_bytes) {\n      var i, tmp, _ref;\n\n      if (num_bytes * 8 > 7500) {\n        throw new Error(\"generate cannot generate > 7500 bits in 1 call.\");\n      }\n\n      if (this.reseed_counter >= 10000) {\n        throw new Error(\"Need a reseed!\");\n      }\n\n      tmp = [];\n      i = 0;\n\n      while (tmp.length === 0 || tmp.length * tmp[0].length * 4 < num_bytes) {\n        this.V = this._hmac(this.K, this.V);\n        tmp.push(this.V.words);\n      }\n\n      this._update();\n\n      this.reseed_counter += 1;\n      return new WordArray((_ref = []).concat.apply(_ref, tmp)).truncate(num_bytes);\n    };\n\n    return DRBG;\n  }();\n\n  ADRBG = function () {\n    function ADRBG(gen_seed, hmac) {\n      this.gen_seed = gen_seed;\n      this.hmac = hmac;\n      this.drbg = null;\n      this.lock = new Lock();\n    }\n\n    ADRBG.prototype.generate = function (n, cb) {\n      var ret, seed, ___iced_passed_deferral, __iced_deferrals, __iced_k;\n\n      __iced_k = __iced_k_noop;\n      ___iced_passed_deferral = iced.findDeferral(arguments);\n      (function (_this) {\n        return function (__iced_k) {\n          __iced_deferrals = new iced.Deferrals(__iced_k, {\n            parent: ___iced_passed_deferral,\n            filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n            funcname: \"ADRBG.generate\"\n          });\n\n          _this.lock.acquire(__iced_deferrals.defer({\n            lineno: 148\n          }));\n\n          __iced_deferrals._fulfill();\n        };\n      })(this)(function (_this) {\n        return function () {\n          (function (__iced_k) {\n            if (_this.drbg == null) {\n              (function (__iced_k) {\n                __iced_deferrals = new iced.Deferrals(__iced_k, {\n                  parent: ___iced_passed_deferral,\n                  filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n                  funcname: \"ADRBG.generate\"\n                });\n\n                _this.gen_seed(256, __iced_deferrals.defer({\n                  assign_fn: function () {\n                    return function () {\n                      return seed = arguments[0];\n                    };\n                  }(),\n                  lineno: 150\n                }));\n\n                __iced_deferrals._fulfill();\n              })(function () {\n                return __iced_k(_this.drbg = new DRBG(seed, null, _this.hmac));\n              });\n            } else {\n              return __iced_k();\n            }\n          })(function () {\n            (function (__iced_k) {\n              if (_this.drbg.reseed_counter > 100) {\n                (function (__iced_k) {\n                  __iced_deferrals = new iced.Deferrals(__iced_k, {\n                    parent: ___iced_passed_deferral,\n                    filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n                    funcname: \"ADRBG.generate\"\n                  });\n\n                  _this.gen_seed(256, __iced_deferrals.defer({\n                    assign_fn: function () {\n                      return function () {\n                        return seed = arguments[0];\n                      };\n                    }(),\n                    lineno: 153\n                  }));\n\n                  __iced_deferrals._fulfill();\n                })(function () {\n                  return __iced_k(_this.drbg.reseed(seed));\n                });\n              } else {\n                return __iced_k();\n              }\n            })(function () {\n              ret = _this.drbg.generate(n);\n\n              _this.lock.release();\n\n              return cb(ret);\n            });\n          });\n        };\n      }(this));\n    };\n\n    return ADRBG;\n  }();\n\n  exports.DRBG = DRBG;\n  exports.ADRBG = ADRBG;\n}).call(this);","map":{"version":3,"sources":["/home/os/Desktop/hello-world-tutorial/node_modules/triplesec/lib/drbg.js"],"names":["ADRBG","DRBG","Lock","WordArray","XOR","hmac","iced","sha3","sha512","__iced_k","__iced_k_noop","require","entropy","personalization_string","hmac_func","sign","security_strength","check_entropy","_instantiate","prototype","reseed","sigBytes","Error","_hmac","key","input","_update","provided_data","V","V_in","concat","clone","K","scrub","i","n","seed_material","from_buffer","Buffer","_i","_results","push","reseed_counter","generate","num_bytes","tmp","_ref","length","words","apply","truncate","gen_seed","drbg","lock","cb","ret","seed","___iced_passed_deferral","__iced_deferrals","findDeferral","arguments","_this","Deferrals","parent","filename","funcname","acquire","defer","lineno","_fulfill","assign_fn","release","exports","call"],"mappings":"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","sourcesContent":["// Generated by IcedCoffeeScript 108.0.8\n(function() {\n  var ADRBG, DRBG, Lock, WordArray, XOR, hmac, iced, sha3, sha512, __iced_k, __iced_k_noop;\n\n  iced = require('iced-runtime');\n  __iced_k = __iced_k_noop = function() {};\n\n  hmac = require('./hmac');\n\n  XOR = require('./combine').XOR;\n\n  sha512 = require('./sha512');\n\n  sha3 = require('./sha3');\n\n  WordArray = require('./wordarray').WordArray;\n\n  Lock = require('iced-lock').Lock;\n\n  DRBG = (function() {\n    function DRBG(entropy, personalization_string, hmac_func) {\n      this.hmac = hmac_func || hmac.sign;\n      this.security_strength = 256;\n      entropy = this.check_entropy(entropy);\n      personalization_string || (personalization_string = new WordArray([]));\n      this._instantiate(entropy, personalization_string);\n    }\n\n    DRBG.prototype.check_entropy = function(entropy, reseed) {\n      if (reseed == null) {\n        reseed = false;\n      }\n      if ((entropy.sigBytes * 8 * 2) < ((reseed ? 2 : 3) * this.security_strength)) {\n        throw new Error(\"entropy must be at least \" + (1.5 * this.security_strength) + \" bits.\");\n      }\n      return entropy;\n    };\n\n    DRBG.prototype._hmac = function(key, input) {\n      return this.hmac({\n        key: key,\n        input: input\n      });\n    };\n\n    DRBG.prototype._update = function(provided_data) {\n      var V, V_in;\n      V = new WordArray([0], 1);\n      if (provided_data != null) {\n        V = V.concat(provided_data);\n      }\n      V_in = this.V.clone().concat(V);\n      this.K = this._hmac(this.K, V_in);\n      V_in.scrub();\n      V.scrub();\n      this.V = this._hmac(this.K, this.V);\n      if (provided_data != null) {\n        V_in = this.V.clone().concat(new WordArray([1 << 24], 1)).concat(provided_data);\n        this.K = this._hmac(this.K, V_in);\n        V_in.scrub();\n        this.V = this._hmac(this.K, this.V);\n      }\n      return provided_data != null ? provided_data.scrub() : void 0;\n    };\n\n    DRBG.prototype._instantiate = function(entropy, personalization_string) {\n      var i, n, seed_material;\n      seed_material = entropy.concat(personalization_string);\n      n = 64;\n      this.K = WordArray.from_buffer(new Buffer((function() {\n        var _i, _results;\n        _results = [];\n        for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {\n          _results.push(0);\n        }\n        return _results;\n      })()));\n      this.V = WordArray.from_buffer(new Buffer((function() {\n        var _i, _results;\n        _results = [];\n        for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {\n          _results.push(1);\n        }\n        return _results;\n      })()));\n      this._update(seed_material);\n      entropy.scrub();\n      return this.reseed_counter = 1;\n    };\n\n    DRBG.prototype.reseed = function(entropy) {\n      this._update(this.check_entropy(entropy, true));\n      return this.reseed_counter = 1;\n    };\n\n    DRBG.prototype.generate = function(num_bytes) {\n      var i, tmp, _ref;\n      if ((num_bytes * 8) > 7500) {\n        throw new Error(\"generate cannot generate > 7500 bits in 1 call.\");\n      }\n      if (this.reseed_counter >= 10000) {\n        throw new Error(\"Need a reseed!\");\n      }\n      tmp = [];\n      i = 0;\n      while ((tmp.length === 0) || (tmp.length * tmp[0].length * 4) < num_bytes) {\n        this.V = this._hmac(this.K, this.V);\n        tmp.push(this.V.words);\n      }\n      this._update();\n      this.reseed_counter += 1;\n      return (new WordArray((_ref = []).concat.apply(_ref, tmp))).truncate(num_bytes);\n    };\n\n    return DRBG;\n\n  })();\n\n  ADRBG = (function() {\n    function ADRBG(gen_seed, hmac) {\n      this.gen_seed = gen_seed;\n      this.hmac = hmac;\n      this.drbg = null;\n      this.lock = new Lock();\n    }\n\n    ADRBG.prototype.generate = function(n, cb) {\n      var ret, seed, ___iced_passed_deferral, __iced_deferrals, __iced_k;\n      __iced_k = __iced_k_noop;\n      ___iced_passed_deferral = iced.findDeferral(arguments);\n      (function(_this) {\n        return (function(__iced_k) {\n          __iced_deferrals = new iced.Deferrals(__iced_k, {\n            parent: ___iced_passed_deferral,\n            filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n            funcname: \"ADRBG.generate\"\n          });\n          _this.lock.acquire(__iced_deferrals.defer({\n            lineno: 148\n          }));\n          __iced_deferrals._fulfill();\n        });\n      })(this)((function(_this) {\n        return function() {\n          (function(__iced_k) {\n            if (_this.drbg == null) {\n              (function(__iced_k) {\n                __iced_deferrals = new iced.Deferrals(__iced_k, {\n                  parent: ___iced_passed_deferral,\n                  filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n                  funcname: \"ADRBG.generate\"\n                });\n                _this.gen_seed(256, __iced_deferrals.defer({\n                  assign_fn: (function() {\n                    return function() {\n                      return seed = arguments[0];\n                    };\n                  })(),\n                  lineno: 150\n                }));\n                __iced_deferrals._fulfill();\n              })(function() {\n                return __iced_k(_this.drbg = new DRBG(seed, null, _this.hmac));\n              });\n            } else {\n              return __iced_k();\n            }\n          })(function() {\n            (function(__iced_k) {\n              if (_this.drbg.reseed_counter > 100) {\n                (function(__iced_k) {\n                  __iced_deferrals = new iced.Deferrals(__iced_k, {\n                    parent: ___iced_passed_deferral,\n                    filename: \"/Users/max/src/keybase/triplesec/src/drbg.iced\",\n                    funcname: \"ADRBG.generate\"\n                  });\n                  _this.gen_seed(256, __iced_deferrals.defer({\n                    assign_fn: (function() {\n                      return function() {\n                        return seed = arguments[0];\n                      };\n                    })(),\n                    lineno: 153\n                  }));\n                  __iced_deferrals._fulfill();\n                })(function() {\n                  return __iced_k(_this.drbg.reseed(seed));\n                });\n              } else {\n                return __iced_k();\n              }\n            })(function() {\n              ret = _this.drbg.generate(n);\n              _this.lock.release();\n              return cb(ret);\n            });\n          });\n        };\n      })(this));\n    };\n\n    return ADRBG;\n\n  })();\n\n  exports.DRBG = DRBG;\n\n  exports.ADRBG = ADRBG;\n\n}).call(this);\n"]},"metadata":{},"sourceType":"script"}