{"ast":null,"code":"/*\n * This module is intended to be executed both on client side and server side.\n * No error should be thrown. (soft error handling)\n */\n(function () {\n  var root = {}; // Dependencies --------------------------------------------------------------\n\n  root.async = typeof require === 'function' ? require('async') : window.async;\n\n  if (typeof root.async !== 'object') {\n    throw new Error('Module async is required (https://github.com/caolan/async)');\n  }\n\n  var async = root.async;\n\n  function _extend(origin, add) {\n    if (!add || typeof add !== 'object') {\n      return origin;\n    }\n\n    var keys = Object.keys(add);\n    var i = keys.length;\n\n    while (i--) {\n      origin[keys[i]] = add[keys[i]];\n    }\n\n    return origin;\n  }\n\n  function _merge() {\n    var ret = {};\n    var args = Array.prototype.slice.call(arguments);\n    var keys = null;\n    var i = null;\n    args.forEach(function (arg) {\n      if (arg && arg.constructor === Object) {\n        keys = Object.keys(arg);\n        i = keys.length;\n\n        while (i--) {\n          ret[keys[i]] = arg[keys[i]];\n        }\n      }\n    });\n    return ret;\n  } // Customisable class (Base class) -------------------------------------------\n  // Use with operation \"new\" to extend Validation and Sanitization themselves,\n  // not their prototype. In other words, constructor shall be call to extend\n  // those functions, instead of being in their constructor, like this:\n  //\t\t_extend(Validation, new Customisable);\n\n\n  function Customisable() {\n    this.custom = {};\n\n    this.extend = function (custom) {\n      return _extend(this.custom, custom);\n    };\n\n    this.reset = function () {\n      this.custom = {};\n    };\n\n    this.remove = function (fields) {\n      if (!_typeIs.array(fields)) {\n        fields = [fields];\n      }\n\n      fields.forEach(function (field) {\n        delete this.custom[field];\n      }, this);\n    };\n  } // Inspection class (Base class) ---------------------------------------------\n  // Use to extend Validation and Sanitization prototypes. Inspection\n  // constructor shall be called in derived class constructor.\n\n\n  function Inspection(schema, custom) {\n    var _stack = ['@'];\n    this._schema = schema;\n    this._custom = {};\n\n    if (custom != null) {\n      for (var key in custom) {\n        if (Object.prototype.hasOwnProperty.call(custom, key)) {\n          this._custom['$' + key] = custom[key];\n        }\n      }\n    }\n\n    this._getDepth = function () {\n      return _stack.length;\n    };\n\n    this._dumpStack = function () {\n      return _stack.map(function (i) {\n        return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e');\n      }).join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\n    };\n\n    this._deeperObject = function (name) {\n      _stack.push(/^[a-z$_][a-z0-9$_]*$/i.test(name) ? name : '[\"' + name + '\"]');\n\n      return this;\n    };\n\n    this._deeperArray = function (i) {\n      _stack.push('[' + i + ']');\n\n      return this;\n    };\n\n    this._back = function () {\n      _stack.pop();\n\n      return this;\n    };\n  } // Simple types --------------------------------------------------------------\n  // If the property is not defined or is not in this list:\n\n\n  var _typeIs = {\n    \"function\": function (element) {\n      return typeof element === 'function';\n    },\n    \"string\": function (element) {\n      return typeof element === 'string';\n    },\n    \"number\": function (element) {\n      return typeof element === 'number' && !isNaN(element);\n    },\n    \"integer\": function (element) {\n      return typeof element === 'number' && element % 1 === 0;\n    },\n    \"NaN\": function (element) {\n      return typeof element === 'number' && isNaN(element);\n    },\n    \"boolean\": function (element) {\n      return typeof element === 'boolean';\n    },\n    \"null\": function (element) {\n      return element === null;\n    },\n    \"date\": function (element) {\n      return element != null && element instanceof Date;\n    },\n    \"object\": function (element) {\n      return element != null && element.constructor === Object;\n    },\n    \"array\": function (element) {\n      return element != null && element.constructor === Array;\n    },\n    \"any\": function (element) {\n      return true;\n    }\n  };\n\n  function _simpleType(type, candidate) {\n    if (typeof type == 'function') {\n      return candidate instanceof type;\n    }\n\n    type = type in _typeIs ? type : 'any';\n    return _typeIs[type](candidate);\n  }\n\n  function _realType(candidate) {\n    for (var i in _typeIs) {\n      if (_simpleType(i, candidate)) {\n        if (i !== 'any') {\n          return i;\n        }\n\n        return 'an instance of ' + candidate.constructor.name;\n      }\n    }\n  }\n\n  function getIndexes(a, value) {\n    var indexes = [];\n    var i = a.indexOf(value);\n\n    while (i !== -1) {\n      indexes.push(i);\n      i = a.indexOf(value, i + 1);\n    }\n\n    return indexes;\n  } // Available formats ---------------------------------------------------------\n\n\n  var _formats = {\n    'void': /^$/,\n    'url': /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\n    'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\n    'date': /^\\d{4}-\\d{2}-\\d{2}$/,\n    'coolDateTime': /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\n    'time': /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\n    'color': /^#([0-9a-f])+$/i,\n    'email': /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n    'numeric': /^[0-9]+$/,\n    'integer': /^\\-?[0-9]+$/,\n    'decimal': /^\\-?[0-9]*\\.?[0-9]+$/,\n    'alpha': /^[a-z]+$/i,\n    'alphaNumeric': /^[a-z0-9]+$/i,\n    'alphaDash': /^[a-z0-9_-]+$/i,\n    'javascript': /^[a-z_\\$][a-z0-9_\\$]*$/i,\n    'upperString': /^[A-Z ]*$/,\n    'lowerString': /^[a-z ]*$/\n  }; // Validation ------------------------------------------------------------------\n\n  var _validationAttribut = {\n    optional: function (schema, candidate) {\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : schema.optional === 'true'; // Default is false\n\n      if (opt === true) {\n        return;\n      }\n\n      if (typeof candidate === 'undefined') {\n        this.report('is missing and not optional', null, 'optional');\n      }\n    },\n    type: function (schema, candidate) {\n      // return because optional function already handle this case\n      if (typeof candidate === 'undefined' || typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function') {\n        return;\n      }\n\n      var types = _typeIs.array(schema.type) ? schema.type : [schema.type];\n      var typeIsValid = types.some(function (type) {\n        return _simpleType(type, candidate);\n      });\n\n      if (!typeIsValid) {\n        types = types.map(function (t) {\n          return typeof t === 'function' ? 'and instance of ' + t.name : t;\n        });\n        this.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\n      }\n    },\n    uniqueness: function (schema, candidate) {\n      if (typeof schema.uniqueness === 'string') {\n        schema.uniqueness = schema.uniqueness === 'true';\n      }\n\n      if (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || !_typeIs.array(candidate) && typeof candidate !== 'string') {\n        return;\n      }\n\n      var reported = [];\n\n      for (var i = 0; i < candidate.length; i++) {\n        if (reported.indexOf(candidate[i]) >= 0) {\n          continue;\n        }\n\n        var indexes = getIndexes(candidate, candidate[i]);\n\n        if (indexes.length > 1) {\n          reported.push(candidate[i]);\n          this.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\n        }\n      }\n    },\n    pattern: function (schema, candidate) {\n      var self = this;\n      var regexs = schema.pattern;\n\n      if (typeof candidate !== 'string') {\n        return;\n      }\n\n      var matches = false;\n\n      if (!_typeIs.array(regexs)) {\n        regexs = [regexs];\n      }\n\n      regexs.forEach(function (regex) {\n        if (typeof regex === 'string' && regex in _formats) {\n          regex = _formats[regex];\n        }\n\n        if (regex instanceof RegExp) {\n          if (regex.test(candidate)) {\n            matches = true;\n          }\n        }\n      });\n\n      if (!matches) {\n        self.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\n      }\n    },\n    validDate: function (schema, candidate) {\n      if (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\n        this.report('must be a valid date', null, 'validDate');\n      }\n    },\n    minLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n\n      var minLength = Number(schema.minLength);\n\n      if (isNaN(minLength)) {\n        return;\n      }\n\n      if (candidate.length < minLength) {\n        this.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\n      }\n    },\n    maxLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n\n      var maxLength = Number(schema.maxLength);\n\n      if (isNaN(maxLength)) {\n        return;\n      }\n\n      if (candidate.length > maxLength) {\n        this.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\n      }\n    },\n    exactLength: function (schema, candidate) {\n      if (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n        return;\n      }\n\n      var exactLength = Number(schema.exactLength);\n\n      if (isNaN(exactLength)) {\n        return;\n      }\n\n      if (candidate.length !== exactLength) {\n        this.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\n      }\n    },\n    lt: function (schema, candidate) {\n      var limit = Number(schema.lt);\n\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n\n      if (candidate >= limit) {\n        this.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\n      }\n    },\n    lte: function (schema, candidate) {\n      var limit = Number(schema.lte);\n\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n\n      if (candidate > limit) {\n        this.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\n      }\n    },\n    gt: function (schema, candidate) {\n      var limit = Number(schema.gt);\n\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n\n      if (candidate <= limit) {\n        this.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\n      }\n    },\n    gte: function (schema, candidate) {\n      var limit = Number(schema.gte);\n\n      if (typeof candidate !== 'number' || isNaN(limit)) {\n        return;\n      }\n\n      if (candidate < limit) {\n        this.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\n      }\n    },\n    eq: function (schema, candidate) {\n      if (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\n        return;\n      }\n\n      var limit = schema.eq;\n\n      if (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\n        return;\n      }\n\n      if (_typeIs.array(limit)) {\n        for (var i = 0; i < limit.length; i++) {\n          if (candidate === limit[i]) {\n            return;\n          }\n        }\n\n        this.report('must be equal to [' + limit.map(function (l) {\n          return '\"' + l + '\"';\n        }).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\n      } else {\n        if (candidate !== limit) {\n          this.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\n        }\n      }\n    },\n    ne: function (schema, candidate) {\n      if (typeof candidate !== 'number' && typeof candidate !== 'string') {\n        return;\n      }\n\n      var limit = schema.ne;\n\n      if (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\n        return;\n      }\n\n      if (_typeIs.array(limit)) {\n        for (var i = 0; i < limit.length; i++) {\n          if (candidate === limit[i]) {\n            this.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\n            return;\n          }\n        }\n      } else {\n        if (candidate === limit) {\n          this.report('must not be equal to \"' + limit + '\"', null, 'ne');\n        }\n      }\n    },\n    someKeys: function (schema, candidat) {\n      var _keys = schema.someKeys;\n\n      if (!_typeIs.object(candidat)) {\n        return;\n      }\n\n      var valid = _keys.some(function (action) {\n        return action in candidat;\n      });\n\n      if (!valid) {\n        this.report('must have at least key ' + _keys.map(function (i) {\n          return '\"' + i + '\"';\n        }).join(' or '), null, 'someKeys');\n      }\n    },\n    strict: function (schema, candidate) {\n      if (typeof schema.strict === 'string') {\n        schema.strict = schema.strict === 'true';\n      }\n\n      if (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\n        return;\n      }\n\n      var self = this;\n\n      if (typeof schema.properties['*'] === 'undefined') {\n        var intruder = Object.keys(candidate).filter(function (key) {\n          return typeof schema.properties[key] === 'undefined';\n        });\n\n        if (intruder.length > 0) {\n          var msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') + ' [' + intruder.map(function (i) {\n            return '\"' + i + '\"';\n          }).join(', ') + ']';\n          self.report(msg, null, 'strict');\n        }\n      }\n    },\n    exec: function (schema, candidate, callback) {\n      var self = this;\n\n      if (typeof callback === 'function') {\n        return this.asyncExec(schema, candidate, callback);\n      }\n\n      (_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\n        if (typeof exec === 'function') {\n          exec.call(self, schema, candidate);\n        }\n      });\n    },\n    properties: function (schema, candidate, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncProperties(schema, candidate, callback);\n      }\n\n      if (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\n        return;\n      }\n\n      var properties = schema.properties,\n          i;\n\n      if (properties['*'] != null) {\n        for (i in candidate) {\n          if (i in properties) {\n            continue;\n          }\n\n          this._deeperObject(i);\n\n          this._validate(properties['*'], candidate[i]);\n\n          this._back();\n        }\n      }\n\n      for (i in properties) {\n        if (i === '*') {\n          continue;\n        }\n\n        this._deeperObject(i);\n\n        this._validate(properties[i], candidate[i]);\n\n        this._back();\n      }\n    },\n    items: function (schema, candidate, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncItems(schema, candidate, callback);\n      }\n\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n        return;\n      }\n\n      var items = schema.items;\n      var i, l; // If provided schema is an array\n      // then call validate for each case\n      // else it is an Object\n      // then call validate for each key\n\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\n        for (i = 0, l = items.length; i < l; i++) {\n          this._deeperArray(i);\n\n          this._validate(items[i], candidate[i]);\n\n          this._back();\n        }\n      } else {\n        for (var key in candidate) {\n          if (Object.prototype.hasOwnProperty.call(candidate, key)) {\n            this._deeperArray(key);\n\n            this._validate(items, candidate[key]);\n\n            this._back();\n          }\n        }\n      }\n    }\n  };\n  var _asyncValidationAttribut = {\n    asyncExec: function (schema, candidate, callback) {\n      var self = this;\n      async.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\n        if (typeof exec === 'function') {\n          if (exec.length > 2) {\n            return exec.call(self, schema, candidate, done);\n          }\n\n          exec.call(self, schema, candidate);\n        }\n\n        async.nextTick(done);\n      }, callback);\n    },\n    asyncProperties: function (schema, candidate, callback) {\n      if (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\n        return callback();\n      }\n\n      var self = this;\n      var properties = schema.properties;\n      async.series([function (next) {\n        if (properties['*'] == null) {\n          return next();\n        }\n\n        async.eachSeries(Object.keys(candidate), function (i, done) {\n          if (i in properties) {\n            return async.nextTick(done);\n          }\n\n          self._deeperObject(i);\n\n          self._asyncValidate(properties['*'], candidate[i], function (err) {\n            self._back();\n\n            done(err);\n          });\n        }, next);\n      }, function (next) {\n        async.eachSeries(Object.keys(properties), function (i, done) {\n          if (i === '*') {\n            return async.nextTick(done);\n          }\n\n          self._deeperObject(i);\n\n          self._asyncValidate(properties[i], candidate[i], function (err) {\n            self._back();\n\n            done(err);\n          });\n        }, next);\n      }], callback);\n    },\n    asyncItems: function (schema, candidate, callback) {\n      if (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n        return callback();\n      }\n\n      var self = this;\n      var items = schema.items;\n      var i, l;\n\n      if (_typeIs.array(items) && _typeIs.array(candidate)) {\n        async.timesSeries(items.length, function (i, done) {\n          self._deeperArray(i);\n\n          self._asyncValidate(items[i], candidate[i], function (err, res) {\n            self._back();\n\n            done(err, res);\n          });\n\n          self._back();\n        }, callback);\n      } else {\n        async.eachSeries(Object.keys(candidate), function (key, done) {\n          self._deeperArray(key);\n\n          self._asyncValidate(items, candidate[key], function (err, res) {\n            self._back();\n\n            done(err, res);\n          });\n        }, callback);\n      }\n    }\n  }; // Validation Class ----------------------------------------------------------\n  // inherits from Inspection class (actually we just call Inspection\n  // constructor with the new context, because its prototype is empty\n\n  function Validation(schema, custom) {\n    Inspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\n    var _error = [];\n    this._basicFields = Object.keys(_validationAttribut);\n    this._customFields = Object.keys(this._custom);\n    this.origin = null;\n\n    this.report = function (message, code, reason) {\n      var newErr = {\n        code: code || this.userCode || null,\n        reason: reason || 'unknown',\n        message: this.userError || message || 'is invalid',\n        property: this.userAlias ? this.userAlias + ' (' + this._dumpStack() + ')' : this._dumpStack()\n      };\n\n      _error.push(newErr);\n\n      return this;\n    };\n\n    this.result = function () {\n      return {\n        error: _error,\n        valid: _error.length === 0,\n        format: function () {\n          if (this.valid === true) {\n            return 'Candidate is valid';\n          }\n\n          return this.error.map(function (i) {\n            return 'Property ' + i.property + ': ' + i.message;\n          }).join('\\n');\n        }\n      };\n    };\n  }\n\n  _extend(Validation.prototype, _validationAttribut);\n\n  _extend(Validation.prototype, _asyncValidationAttribut);\n\n  _extend(Validation, new Customisable());\n\n  Validation.prototype.validate = function (candidate, callback) {\n    this.origin = candidate;\n\n    if (typeof callback === 'function') {\n      var self = this;\n      return async.nextTick(function () {\n        self._asyncValidate(self._schema, candidate, function (err) {\n          self.origin = null;\n          callback(err, self.result());\n        });\n      });\n    }\n\n    return this._validate(this._schema, candidate).result();\n  };\n\n  Validation.prototype._validate = function (schema, candidate, callback) {\n    this.userCode = schema.code || null;\n    this.userError = schema.error || null;\n    this.userAlias = schema.alias || null;\n\n    this._basicFields.forEach(function (i) {\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n        this[i](schema, candidate);\n      }\n    }, this);\n\n    this._customFields.forEach(function (i) {\n      if (i in schema && typeof this._custom[i] === 'function') {\n        this._custom[i].call(this, schema, candidate);\n      }\n    }, this);\n\n    return this;\n  };\n\n  Validation.prototype._asyncValidate = function (schema, candidate, callback) {\n    var self = this;\n    this.userCode = schema.code || null;\n    this.userError = schema.error || null;\n    this.userAlias = schema.alias || null;\n    async.series([function (next) {\n      async.eachSeries(Object.keys(_validationAttribut), function (i, done) {\n        async.nextTick(function () {\n          if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n            if (self[i].length > 2) {\n              return self[i](schema, candidate, done);\n            }\n\n            self[i](schema, candidate);\n          }\n\n          done();\n        });\n      }, next);\n    }, function (next) {\n      async.eachSeries(Object.keys(self._custom), function (i, done) {\n        async.nextTick(function () {\n          if (i in schema && typeof self._custom[i] === 'function') {\n            if (self._custom[i].length > 2) {\n              return self._custom[i].call(self, schema, candidate, done);\n            }\n\n            self._custom[i].call(self, schema, candidate);\n          }\n\n          done();\n        });\n      }, next);\n    }], callback);\n  }; // Sanitization ----------------------------------------------------------------\n  // functions called by _sanitization.type method.\n\n\n  var _forceType = {\n    number: function (post, schema) {\n      var n;\n\n      if (typeof post === 'number') {\n        return post;\n      } else if (post === '') {\n        if (typeof schema.def !== 'undefined') return schema.def;\n        return null;\n      } else if (typeof post === 'string') {\n        n = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\n\n        if (typeof n === 'number') {\n          return n;\n        }\n      } else if (post instanceof Date) {\n        return +post;\n      }\n\n      return null;\n    },\n    integer: function (post, schema) {\n      var n;\n\n      if (typeof post === 'number' && post % 1 === 0) {\n        return post;\n      } else if (post === '') {\n        if (typeof schema.def !== 'undefined') return schema.def;\n        return null;\n      } else if (typeof post === 'string') {\n        n = parseInt(post.replace(/ /g, ''), 10);\n\n        if (typeof n === 'number') {\n          return n;\n        }\n      } else if (typeof post === 'number') {\n        return parseInt(post, 10);\n      } else if (typeof post === 'boolean') {\n        if (post) {\n          return 1;\n        }\n\n        return 0;\n      } else if (post instanceof Date) {\n        return +post;\n      }\n\n      return null;\n    },\n    string: function (post, schema) {\n      if (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\n        return post.toString();\n      } else if (_typeIs.array(post)) {\n        // If user authorize array and strings...\n        if (schema.items || schema.properties) return post;\n        return post.join(String(schema.joinWith || ','));\n      } else if (post instanceof Object) {\n        // If user authorize objects ans strings...\n        if (schema.items || schema.properties) return post;\n        return JSON.stringify(post);\n      } else if (typeof post === 'string' && post.length) {\n        return post;\n      }\n\n      return null;\n    },\n    date: function (post, schema) {\n      if (post instanceof Date) {\n        return post;\n      } else {\n        var d = new Date(post);\n\n        if (!isNaN(d.getTime())) {\n          // if valid date\n          return d;\n        }\n      }\n\n      return null;\n    },\n    boolean: function (post, schema) {\n      if (typeof post === 'undefined') return null;\n      if (typeof post === 'string' && post.toLowerCase() === 'false') return false;\n      return !!post;\n    },\n    object: function (post, schema) {\n      if (typeof post !== 'string' || _typeIs.object(post)) {\n        return post;\n      }\n\n      try {\n        return JSON.parse(post);\n      } catch (e) {\n        return null;\n      }\n    },\n    array: function (post, schema) {\n      if (_typeIs.array(post)) return post;\n      if (typeof post === 'undefined') return null;\n\n      if (typeof post === 'string') {\n        if (post.substring(0, 1) === '[' && post.slice(-1) === ']') {\n          try {\n            return JSON.parse(post);\n          } catch (e) {\n            return null;\n          }\n        }\n\n        return post.split(String(schema.splitWith || ','));\n      }\n\n      if (!_typeIs.array(post)) return [post];\n      return null;\n    }\n  };\n  var _applyRules = {\n    upper: function (post) {\n      return post.toUpperCase();\n    },\n    lower: function (post) {\n      return post.toLowerCase();\n    },\n    title: function (post) {\n      // Fix by seb (replace \\w\\S* by \\S* => exemple : coucou ça va)\n      return post.replace(/\\S*/g, function (txt) {\n        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n      });\n    },\n    capitalize: function (post) {\n      return post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\n    },\n    ucfirst: function (post) {\n      return post.charAt(0).toUpperCase() + post.substr(1);\n    },\n    trim: function (post) {\n      return post.trim();\n    }\n  }; // Every function return the future value of each property. Therefore you\n  // have to return post even if you do not change its value\n\n  var _sanitizationAttribut = {\n    strict: function (schema, post) {\n      if (typeof schema.strict === 'string') {\n        schema.strict = schema.strict === 'true';\n      }\n\n      if (schema.strict !== true) return post;\n      if (!_typeIs.object(schema.properties)) return post;\n      if (!_typeIs.object(post)) return post;\n      var that = this;\n      Object.keys(post).forEach(function (key) {\n        if (!(key in schema.properties)) {\n          delete post[key];\n        }\n      });\n      return post;\n    },\n    optional: function (schema, post) {\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : schema.optional !== 'false'; // Default: true\n\n      if (opt === true) {\n        return post;\n      }\n\n      if (typeof post !== 'undefined') {\n        return post;\n      }\n\n      this.report();\n\n      if (schema.def === Date) {\n        return new Date();\n      }\n\n      return schema.def;\n    },\n    type: function (schema, post) {\n      // if (_typeIs['object'](post) || _typeIs.array(post)) {\n      // \treturn post;\n      // }\n      if (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\n        return post;\n      }\n\n      var n;\n      var opt = typeof schema.optional === 'boolean' ? schema.optional : true;\n\n      if (typeof _forceType[schema.type] === 'function') {\n        n = _forceType[schema.type](post, schema);\n\n        if (n === null && !opt || !n && isNaN(n) || n === null && schema.type === 'string') {\n          n = schema.def;\n        }\n      } else if (!opt) {\n        n = schema.def;\n      }\n\n      if ((n != null || typeof schema.def !== 'undefined' && schema.def === n) && n !== post) {\n        this.report();\n        return n;\n      }\n\n      return post;\n    },\n    rules: function (schema, post) {\n      var rules = schema.rules;\n\n      if (typeof post !== 'string' || typeof rules !== 'string' && !_typeIs.array(rules)) {\n        return post;\n      }\n\n      var modified = false;\n      (_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\n        if (typeof _applyRules[rule] === 'function') {\n          post = _applyRules[rule](post);\n          modified = true;\n        }\n      });\n\n      if (modified) {\n        this.report();\n      }\n\n      return post;\n    },\n    min: function (schema, post) {\n      var postTest = Number(post);\n\n      if (isNaN(postTest)) {\n        return post;\n      }\n\n      var min = Number(schema.min);\n\n      if (isNaN(min)) {\n        return post;\n      }\n\n      if (postTest < min) {\n        this.report();\n        return min;\n      }\n\n      return post;\n    },\n    max: function (schema, post) {\n      var postTest = Number(post);\n\n      if (isNaN(postTest)) {\n        return post;\n      }\n\n      var max = Number(schema.max);\n\n      if (isNaN(max)) {\n        return post;\n      }\n\n      if (postTest > max) {\n        this.report();\n        return max;\n      }\n\n      return post;\n    },\n    minLength: function (schema, post) {\n      var limit = Number(schema.minLength);\n\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n        return post;\n      }\n\n      var str = '';\n      var gap = limit - post.length;\n\n      if (gap > 0) {\n        for (var i = 0; i < gap; i++) {\n          str += '-';\n        }\n\n        this.report();\n        return post + str;\n      }\n\n      return post;\n    },\n    maxLength: function (schema, post) {\n      var limit = Number(schema.maxLength);\n\n      if (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n        return post;\n      }\n\n      if (post.length > limit) {\n        this.report();\n        return post.slice(0, limit);\n      }\n\n      return post;\n    },\n    properties: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncProperties(schema, post, callback);\n      }\n\n      if (!post || typeof post !== 'object') {\n        return post;\n      }\n\n      var properties = schema.properties;\n      var tmp;\n      var i;\n\n      if (typeof properties['*'] !== 'undefined') {\n        for (i in post) {\n          if (i in properties) {\n            continue;\n          }\n\n          this._deeperObject(i);\n\n          tmp = this._sanitize(schema.properties['*'], post[i]);\n\n          if (typeof tmp !== 'undefined') {\n            post[i] = tmp;\n          }\n\n          this._back();\n        }\n      }\n\n      for (i in schema.properties) {\n        if (i !== '*') {\n          this._deeperObject(i);\n\n          tmp = this._sanitize(schema.properties[i], post[i]);\n\n          if (typeof tmp !== 'undefined') {\n            post[i] = tmp;\n          }\n\n          this._back();\n        }\n      }\n\n      return post;\n    },\n    items: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncItems(schema, post, callback);\n      }\n\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\n        return post;\n      }\n\n      var i;\n\n      if (_typeIs.array(schema.items) && _typeIs.array(post)) {\n        var minLength = schema.items.length < post.length ? schema.items.length : post.length;\n\n        for (i = 0; i < minLength; i++) {\n          this._deeperArray(i);\n\n          post[i] = this._sanitize(schema.items[i], post[i]);\n\n          this._back();\n        }\n      } else {\n        for (i in post) {\n          if (Object.prototype.hasOwnProperty.call(post, i)) {\n            this._deeperArray(i);\n\n            post[i] = this._sanitize(schema.items, post[i]);\n\n            this._back();\n          }\n        }\n      }\n\n      return post;\n    },\n    exec: function (schema, post, callback) {\n      if (typeof callback === 'function') {\n        return this.asyncExec(schema, post, callback);\n      }\n\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n      execs.forEach(function (exec) {\n        if (typeof exec === 'function') {\n          post = exec.call(this, schema, post);\n        }\n      }, this);\n      return post;\n    }\n  };\n  var _asyncSanitizationAttribut = {\n    asyncExec: function (schema, post, callback) {\n      var self = this;\n      var execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n      async.eachSeries(execs, function (exec, done) {\n        if (typeof exec === 'function') {\n          if (exec.length > 2) {\n            return exec.call(self, schema, post, function (err, res) {\n              if (err) {\n                return done(err);\n              }\n\n              post = res;\n              done();\n            });\n          }\n\n          post = exec.call(self, schema, post);\n        }\n\n        done();\n      }, function (err) {\n        callback(err, post);\n      });\n    },\n    asyncProperties: function (schema, post, callback) {\n      if (!post || typeof post !== 'object') {\n        return callback(null, post);\n      }\n\n      var self = this;\n      var properties = schema.properties;\n      async.series([function (next) {\n        if (properties['*'] == null) {\n          return next();\n        }\n\n        var globing = properties['*'];\n        async.eachSeries(Object.keys(post), function (i, next) {\n          if (i in properties) {\n            return next();\n          }\n\n          self._deeperObject(i);\n\n          self._asyncSanitize(globing, post[i], function (err, res) {\n            if (err) {\n              /* Error can safely be ignored here */\n            }\n\n            if (typeof res !== 'undefined') {\n              post[i] = res;\n            }\n\n            self._back();\n\n            next();\n          });\n        }, next);\n      }, function (next) {\n        async.eachSeries(Object.keys(properties), function (i, next) {\n          if (i === '*') {\n            return next();\n          }\n\n          self._deeperObject(i);\n\n          self._asyncSanitize(properties[i], post[i], function (err, res) {\n            if (err) {\n              return next(err);\n            }\n\n            if (typeof res !== 'undefined') {\n              post[i] = res;\n            }\n\n            self._back();\n\n            next();\n          });\n        }, next);\n      }], function (err) {\n        return callback(err, post);\n      });\n    },\n    asyncItems: function (schema, post, callback) {\n      if (!(schema.items instanceof Object) || !(post instanceof Object)) {\n        return callback(null, post);\n      }\n\n      var self = this;\n      var items = schema.items;\n\n      if (_typeIs.array(items) && _typeIs.array(post)) {\n        var minLength = items.length < post.length ? items.length : post.length;\n        async.timesSeries(minLength, function (i, next) {\n          self._deeperArray(i);\n\n          self._asyncSanitize(items[i], post[i], function (err, res) {\n            if (err) {\n              return next(err);\n            }\n\n            post[i] = res;\n\n            self._back();\n\n            next();\n          });\n        }, function (err) {\n          callback(err, post);\n        });\n      } else {\n        async.eachSeries(Object.keys(post), function (key, next) {\n          self._deeperArray(key);\n\n          self._asyncSanitize(items, post[key], function (err, res) {\n            if (err) {\n              return next();\n            }\n\n            post[key] = res;\n\n            self._back();\n\n            next();\n          });\n        }, function (err) {\n          callback(err, post);\n        });\n      }\n\n      return post;\n    }\n  }; // Sanitization Class --------------------------------------------------------\n  // inherits from Inspection class (actually we just call Inspection\n  // constructor with the new context, because its prototype is empty\n\n  function Sanitization(schema, custom) {\n    Inspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\n    var _reporting = [];\n    this._basicFields = Object.keys(_sanitizationAttribut);\n    this._customFields = Object.keys(this._custom);\n    this.origin = null;\n\n    this.report = function (message) {\n      var newNot = {\n        message: message || 'was sanitized',\n        property: this.userAlias ? this.userAlias + ' (' + this._dumpStack() + ')' : this._dumpStack()\n      };\n\n      if (!_reporting.some(function (e) {\n        return e.property === newNot.property;\n      })) {\n        _reporting.push(newNot);\n      }\n    };\n\n    this.result = function (data) {\n      return {\n        data: data,\n        reporting: _reporting,\n        format: function () {\n          return this.reporting.map(function (i) {\n            return 'Property ' + i.property + ' ' + i.message;\n          }).join('\\n');\n        }\n      };\n    };\n  }\n\n  _extend(Sanitization.prototype, _sanitizationAttribut);\n\n  _extend(Sanitization.prototype, _asyncSanitizationAttribut);\n\n  _extend(Sanitization, new Customisable());\n\n  Sanitization.prototype.sanitize = function (post, callback) {\n    this.origin = post;\n\n    if (typeof callback === 'function') {\n      var self = this;\n      return this._asyncSanitize(this._schema, post, function (err, data) {\n        self.origin = null;\n        callback(err, self.result(data));\n      });\n    }\n\n    var data = this._sanitize(this._schema, post);\n\n    this.origin = null;\n    return this.result(data);\n  };\n\n  Sanitization.prototype._sanitize = function (schema, post) {\n    this.userAlias = schema.alias || null;\n\n    this._basicFields.forEach(function (i) {\n      if ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n        post = this[i](schema, post);\n      }\n    }, this);\n\n    this._customFields.forEach(function (i) {\n      if (i in schema && typeof this._custom[i] === 'function') {\n        post = this._custom[i].call(this, schema, post);\n      }\n    }, this);\n\n    return post;\n  };\n\n  Sanitization.prototype._asyncSanitize = function (schema, post, callback) {\n    var self = this;\n    this.userAlias = schema.alias || null;\n    async.waterfall([function (next) {\n      async.reduce(self._basicFields, post, function (value, i, next) {\n        async.nextTick(function () {\n          if ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n            if (self[i].length > 2) {\n              return self[i](schema, value, next);\n            }\n\n            value = self[i](schema, value);\n          }\n\n          next(null, value);\n        });\n      }, next);\n    }, function (inter, next) {\n      async.reduce(self._customFields, inter, function (value, i, next) {\n        async.nextTick(function () {\n          if (i in schema && typeof self._custom[i] === 'function') {\n            if (self._custom[i].length > 2) {\n              return self._custom[i].call(self, schema, value, next);\n            }\n\n            value = self._custom[i].call(self, schema, value);\n          }\n\n          next(null, value);\n        });\n      }, next);\n    }], callback);\n  }; // ---------------------------------------------------------------------------\n\n\n  var INT_MIN = -2147483648;\n  var INT_MAX = 2147483647;\n  var _rand = {\n    int: function (min, max) {\n      return min + (0 | Math.random() * (max - min + 1));\n    },\n    float: function (min, max) {\n      return Math.random() * (max - min) + min;\n    },\n    bool: function () {\n      return Math.random() > 0.5;\n    },\n    char: function (min, max) {\n      return String.fromCharCode(this.int(min, max));\n    },\n    fromList: function (list) {\n      return list[this.int(0, list.length - 1)];\n    }\n  };\n  var _formatSample = {\n    'date-time': function () {\n      return new Date().toISOString();\n    },\n    'date': function () {\n      return new Date().toISOString().replace(/T.*$/, '');\n    },\n    'time': function () {\n      return new Date().toLocaleTimeString({}, {\n        hour12: false\n      });\n    },\n    'color': function (min, max) {\n      var s = '#';\n\n      if (min < 1) {\n        min = 1;\n      }\n\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('0123456789abcdefABCDEF');\n      }\n\n      return s;\n    },\n    'numeric': function () {\n      return '' + _rand.int(0, INT_MAX);\n    },\n    'integer': function () {\n      if (_rand.bool() === true) {\n        return '-' + this.numeric();\n      }\n\n      return this.numeric();\n    },\n    'decimal': function () {\n      return this.integer() + '.' + this.numeric();\n    },\n    'alpha': function (min, max) {\n      var s = '';\n\n      if (min < 1) {\n        min = 1;\n      }\n\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n      }\n\n      return s;\n    },\n    'alphaNumeric': function (min, max) {\n      var s = '';\n\n      if (min < 1) {\n        min = 1;\n      }\n\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\n      }\n\n      return s;\n    },\n    'alphaDash': function (min, max) {\n      var s = '';\n\n      if (min < 1) {\n        min = 1;\n      }\n\n      for (var i = 0, l = _rand.int(min, max); i < l; i++) {\n        s += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\n      }\n\n      return s;\n    },\n    'javascript': function (min, max) {\n      var s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\n\n      for (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\n        s += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\n      }\n\n      return s;\n    }\n  };\n\n  function _getLimits(schema) {\n    var min = INT_MIN;\n    var max = INT_MAX;\n\n    if (schema.gte != null) {\n      min = schema.gte;\n    } else if (schema.gt != null) {\n      min = schema.gt + 1;\n    }\n\n    if (schema.lte != null) {\n      max = schema.lte;\n    } else if (schema.lt != null) {\n      max = schema.lt - 1;\n    }\n\n    return {\n      min: min,\n      max: max\n    };\n  }\n\n  var _typeGenerator = {\n    string: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n\n      var s = '';\n      var minLength = schema.minLength != null ? schema.minLength : 0;\n      var maxLength = schema.maxLength != null ? schema.maxLength : 32;\n\n      if (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\n        return _formatSample[schema.pattern](minLength, maxLength);\n      }\n\n      var l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\n      for (var i = 0; i < l; i++) {\n        s += _rand.char(32, 126);\n      }\n\n      return s;\n    },\n    number: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n\n      var limit = _getLimits(schema);\n\n      var n = _rand.float(limit.min, limit.max);\n\n      if (schema.ne != null) {\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\n        while (ne.indexOf(n) !== -1) {\n          n = _rand.float(limit.min, limit.max);\n        }\n      }\n\n      return n;\n    },\n    integer: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n\n      var limit = _getLimits(schema);\n\n      var n = _rand.int(limit.min, limit.max);\n\n      if (schema.ne != null) {\n        var ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\n        while (ne.indexOf(n) !== -1) {\n          n = _rand.int(limit.min, limit.max);\n        }\n      }\n\n      return n;\n    },\n    boolean: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n\n      return _rand.bool();\n    },\n    \"null\": function (schema) {\n      return null;\n    },\n    date: function (schema) {\n      if (schema.eq != null) {\n        return schema.eq;\n      }\n\n      return new Date();\n    },\n    object: function (schema) {\n      var o = {};\n      var prop = schema.properties || {};\n\n      for (var key in prop) {\n        if (Object.prototype.hasOwnProperty.call(prop, key)) {\n          if (prop[key].optional === true && _rand.bool() === true) {\n            continue;\n          }\n\n          if (key !== '*') {\n            o[key] = this.generate(prop[key]);\n          } else {\n            var rk = '__random_key_';\n            var randomKey = rk + 0;\n\n            var n = _rand.int(1, 9);\n\n            for (var i = 1; i <= n; i++) {\n              if (!(randomKey in prop)) {\n                o[randomKey] = this.generate(prop[key]);\n              }\n\n              randomKey = rk + i;\n            }\n          }\n        }\n      }\n\n      return o;\n    },\n    array: function (schema) {\n      var self = this;\n      var items = schema.items || {};\n      var minLength = schema.minLength != null ? schema.minLength : 0;\n      var maxLength = schema.maxLength != null ? schema.maxLength : 16;\n      var type;\n      var candidate;\n      var size;\n      var i;\n\n      if (_typeIs.array(items)) {\n        size = items.length;\n\n        if (schema.exactLength != null) {\n          size = schema.exactLength;\n        } else if (size < minLength) {\n          size = minLength;\n        } else if (size > maxLength) {\n          size = maxLength;\n        }\n\n        candidate = new Array(size);\n        type = null;\n\n        for (i = 0; i < size; i++) {\n          type = items[i].type || 'any';\n\n          if (_typeIs.array(type)) {\n            type = type[_rand.int(0, type.length - 1)];\n          }\n\n          candidate[i] = self[type](items[i]);\n        }\n      } else {\n        size = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n        candidate = new Array(size);\n        type = items.type || 'any';\n\n        if (_typeIs.array(type)) {\n          type = type[_rand.int(0, type.length - 1)];\n        }\n\n        for (i = 0; i < size; i++) {\n          candidate[i] = self[type](items);\n        }\n      }\n\n      return candidate;\n    },\n    any: function (schema) {\n      var fields = Object.keys(_typeGenerator);\n\n      var i = fields[_rand.int(0, fields.length - 2)];\n\n      return this[i](schema);\n    }\n  }; // CandidateGenerator Class (Singleton) --------------------------------------\n\n  function CandidateGenerator() {// Maybe extends Inspection class too ?\n  }\n\n  _extend(CandidateGenerator.prototype, _typeGenerator);\n\n  var _instance = null;\n\n  CandidateGenerator.instance = function () {\n    if (!(_instance instanceof CandidateGenerator)) {\n      _instance = new CandidateGenerator();\n    }\n\n    return _instance;\n  };\n\n  CandidateGenerator.prototype.generate = function (schema) {\n    var type = schema.type || 'any';\n\n    if (_typeIs.array(type)) {\n      type = type[_rand.int(0, type.length - 1)];\n    }\n\n    return this[type](schema);\n  }; // Exports ---------------------------------------------------------------------\n\n\n  var SchemaInspector = {}; // if server-side (node.js) else client-side\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = SchemaInspector;\n  } else {\n    window.SchemaInspector = SchemaInspector;\n  }\n\n  SchemaInspector.newSanitization = function (schema, custom) {\n    return new Sanitization(schema, custom);\n  };\n\n  SchemaInspector.newValidation = function (schema, custom) {\n    return new Validation(schema, custom);\n  };\n\n  SchemaInspector.Validation = Validation;\n  SchemaInspector.Sanitization = Sanitization;\n\n  SchemaInspector.sanitize = function (schema, post, custom, callback) {\n    if (arguments.length === 3 && typeof custom === 'function') {\n      callback = custom;\n      custom = null;\n    }\n\n    return new Sanitization(schema, custom).sanitize(post, callback);\n  };\n\n  SchemaInspector.validate = function (schema, candidate, custom, callback) {\n    if (arguments.length === 3 && typeof custom === 'function') {\n      callback = custom;\n      custom = null;\n    }\n\n    return new Validation(schema, custom).validate(candidate, callback);\n  };\n\n  SchemaInspector.generate = function (schema, n) {\n    if (typeof n === 'number') {\n      var r = new Array(n);\n\n      for (var i = 0; i < n; i++) {\n        r[i] = CandidateGenerator.instance().generate(schema);\n      }\n\n      return r;\n    }\n\n    return CandidateGenerator.instance().generate(schema);\n  };\n})();","map":{"version":3,"sources":["/home/os/Desktop/hello-world-tutorial/node_modules/schema-inspector/lib/schema-inspector.js"],"names":["root","async","require","window","Error","_extend","origin","add","keys","Object","i","length","_merge","ret","args","Array","prototype","slice","call","arguments","forEach","arg","constructor","Customisable","custom","extend","reset","remove","fields","_typeIs","array","field","Inspection","schema","_stack","_schema","_custom","key","hasOwnProperty","_getDepth","_dumpStack","map","replace","join","_deeperObject","name","push","test","_deeperArray","_back","pop","element","isNaN","Date","_simpleType","type","candidate","_realType","getIndexes","a","value","indexes","indexOf","_formats","_validationAttribut","optional","opt","report","types","typeIsValid","some","t","uniqueness","reported","pattern","self","regexs","matches","regex","RegExp","validDate","String","getTime","minLength","Number","maxLength","exactLength","lt","limit","lte","gt","gte","eq","l","ne","someKeys","candidat","_keys","object","valid","action","strict","properties","intruder","filter","msg","exec","callback","asyncExec","asyncProperties","_validate","items","asyncItems","_asyncValidationAttribut","eachSeries","done","nextTick","series","next","_asyncValidate","err","timesSeries","res","Validation","_error","_basicFields","_customFields","message","code","reason","newErr","userCode","userError","property","userAlias","result","error","format","validate","alias","_forceType","number","post","n","def","parseFloat","integer","parseInt","string","toString","joinWith","JSON","stringify","date","d","boolean","toLowerCase","parse","e","substring","split","splitWith","_applyRules","upper","toUpperCase","lower","title","txt","charAt","substr","capitalize","ucfirst","trim","_sanitizationAttribut","that","rules","modified","rule","min","postTest","max","str","gap","tmp","_sanitize","execs","_asyncSanitizationAttribut","globing","_asyncSanitize","Sanitization","_reporting","newNot","data","reporting","sanitize","waterfall","reduce","inter","INT_MIN","INT_MAX","_rand","int","Math","random","float","bool","char","fromCharCode","fromList","list","_formatSample","toISOString","toLocaleTimeString","hour12","s","numeric","_getLimits","_typeGenerator","o","prop","generate","rk","randomKey","size","any","CandidateGenerator","_instance","instance","SchemaInspector","module","exports","newSanitization","newValidation","r"],"mappings":"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","sourcesContent":["/*\n * This module is intended to be executed both on client side and server side.\n * No error should be thrown. (soft error handling)\n */\n\n(function () {\n\tvar root = {};\n\t// Dependencies --------------------------------------------------------------\n\troot.async = (typeof require === 'function') ? require('async') : window.async;\n\tif (typeof root.async !== 'object') {\n\t\tthrow new Error('Module async is required (https://github.com/caolan/async)');\n\t}\n\tvar async = root.async;\n\n\tfunction _extend(origin, add) {\n\t\tif (!add || typeof add !== 'object') {\n\t\t\treturn origin;\n\t\t}\n\t\tvar keys = Object.keys(add);\n\t\tvar i = keys.length;\n\t\twhile (i--) {\n\t\t\torigin[keys[i]] = add[keys[i]];\n\t\t}\n\t\treturn origin;\n\t}\n\n\tfunction _merge() {\n\t\tvar ret = {};\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\tvar keys = null;\n\t\tvar i = null;\n\n\t\targs.forEach(function (arg) {\n\t\t\tif (arg && arg.constructor === Object) {\n\t\t\t\tkeys = Object.keys(arg);\n\t\t\t\ti = keys.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tret[keys[i]] = arg[keys[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn ret;\n\t}\n\n\t// Customisable class (Base class) -------------------------------------------\n\t// Use with operation \"new\" to extend Validation and Sanitization themselves,\n\t// not their prototype. In other words, constructor shall be call to extend\n\t// those functions, instead of being in their constructor, like this:\n\t//\t\t_extend(Validation, new Customisable);\n\n\tfunction Customisable() {\n\t\tthis.custom = {};\n\n\t\tthis.extend = function (custom) {\n\t\t\treturn _extend(this.custom, custom);\n\t\t};\n\n\t\tthis.reset = function () {\n\t\t\tthis.custom = {};\n\t\t};\n\n\t\tthis.remove = function (fields) {\n\t\t\tif (!_typeIs.array(fields)) {\n\t\t\t\tfields = [fields];\n\t\t\t}\n\t\t\tfields.forEach(function (field) {\n\t\t\t\tdelete this.custom[field];\n\t\t\t}, this);\n\t\t};\n\t}\n\n\t// Inspection class (Base class) ---------------------------------------------\n\t// Use to extend Validation and Sanitization prototypes. Inspection\n\t// constructor shall be called in derived class constructor.\n\n\tfunction Inspection(schema, custom) {\n\t\tvar _stack = ['@'];\n\n\t\tthis._schema = schema;\n\t\tthis._custom = {};\n\t\tif (custom != null) {\n\t\t\tfor (var key in custom) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(custom, key)) {\n\t\t\t\t\tthis._custom['$' + key] = custom[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._getDepth = function () {\n\t\t\treturn _stack.length;\n\t\t};\n\n\t\tthis._dumpStack = function () {\n\t\t\treturn _stack.map(function (i) {return i.replace(/^\\[/g, '\\u001b\\u001c\\u001d\\u001e');})\n\t\t\t.join('.').replace(/\\.\\u001b\\u001c\\u001d\\u001e/g, '[');\n\t\t};\n\n\t\tthis._deeperObject = function (name) {\n\t\t\t_stack.push((/^[a-z$_][a-z0-9$_]*$/i).test(name) ? name : '[\"' + name + '\"]');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._deeperArray = function (i) {\n\t\t\t_stack.push('[' + i + ']');\n\t\t\treturn this;\n\t\t};\n\n\t\tthis._back = function () {\n\t\t\t_stack.pop();\n\t\t\treturn this;\n\t\t};\n\t}\n\t// Simple types --------------------------------------------------------------\n\t// If the property is not defined or is not in this list:\n\tvar _typeIs = {\n\t\t\"function\": function (element) {\n\t\t\treturn typeof element === 'function';\n\t\t},\n\t\t\"string\": function (element) {\n\t\t\treturn typeof element === 'string';\n\t\t},\n\t\t\"number\": function (element) {\n\t\t\treturn typeof element === 'number' && !isNaN(element);\n\t\t},\n\t\t\"integer\": function (element) {\n\t\t\treturn typeof element === 'number' && element % 1 === 0;\n\t\t},\n\t\t\"NaN\": function (element) {\n\t\t\treturn typeof element === 'number' && isNaN(element);\n\t\t},\n\t\t\"boolean\": function (element) {\n\t\t\treturn typeof element === 'boolean';\n\t\t},\n\t\t\"null\": function (element) {\n\t\t\treturn element === null;\n\t\t},\n\t\t\"date\": function (element) {\n\t\t\treturn element != null && element instanceof Date;\n\t\t},\n\t\t\"object\": function (element) {\n\t\t\treturn element != null && element.constructor === Object;\n\t\t},\n\t\t\"array\": function (element) {\n\t\t\treturn element != null && element.constructor === Array;\n\t\t},\n\t\t\"any\": function (element) {\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tfunction _simpleType(type, candidate) {\n\t\tif (typeof type == 'function') {\n\t\t\treturn candidate instanceof type;\n\t\t}\n\t\ttype = type in _typeIs ? type : 'any';\n\t\treturn _typeIs[type](candidate);\n\t}\n\n\tfunction _realType(candidate) {\n\t\tfor (var i in _typeIs) {\n\t\t\tif (_simpleType(i, candidate)) {\n\t\t\t\tif (i !== 'any') { return i; }\n\t\t\t\treturn 'an instance of ' + candidate.constructor.name;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getIndexes(a, value) {\n\t\tvar indexes = [];\n\t\tvar i = a.indexOf(value);\n\n\t\twhile (i !== -1) {\n\t\t\tindexes.push(i);\n\t\t\ti = a.indexOf(value, i + 1);\n\t\t}\n\t\treturn indexes;\n\t}\n\n\t// Available formats ---------------------------------------------------------\n\tvar _formats = {\n\t\t'void': /^$/,\n\t\t'url': /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)?(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i,\n\t\t'date-time': /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?(Z?|(-|\\+)\\d{2}:\\d{2})$/,\n\t\t'date': /^\\d{4}-\\d{2}-\\d{2}$/,\n\t\t'coolDateTime': /^\\d{4}(-|\\/)\\d{2}(-|\\/)\\d{2}(T| )\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$/,\n\t\t'time': /^\\d{2}\\:\\d{2}\\:\\d{2}$/,\n\t\t'color': /^#([0-9a-f])+$/i,\n\t\t'email': /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i,\n\t\t'numeric': /^[0-9]+$/,\n\t\t'integer': /^\\-?[0-9]+$/,\n\t\t'decimal': /^\\-?[0-9]*\\.?[0-9]+$/,\n\t\t'alpha': /^[a-z]+$/i,\n\t\t'alphaNumeric': /^[a-z0-9]+$/i,\n\t\t'alphaDash': /^[a-z0-9_-]+$/i,\n\t\t'javascript': /^[a-z_\\$][a-z0-9_\\$]*$/i,\n\t\t'upperString': /^[A-Z ]*$/,\n\t\t'lowerString': /^[a-z ]*$/\n\t};\n\n// Validation ------------------------------------------------------------------\n\tvar _validationAttribut = {\n\t\toptional: function (schema, candidate) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional === 'true'); // Default is false\n\n\t\t\tif (opt === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof candidate === 'undefined') {\n\t\t\t\tthis.report('is missing and not optional', null, 'optional');\n\t\t\t}\n\t\t},\n\t\ttype: function (schema, candidate) {\n\t\t\t// return because optional function already handle this case\n\t\t\tif (typeof candidate === 'undefined' || (typeof schema.type !== 'string' && !(schema.type instanceof Array) && typeof schema.type !== 'function')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar types = _typeIs.array(schema.type) ? schema.type : [schema.type];\n\t\t\tvar typeIsValid = types.some(function (type) {\n\t\t\t\treturn _simpleType(type, candidate);\n\t\t\t});\n\t\t\tif (!typeIsValid) {\n\t\t\t\ttypes = types.map(function (t) {return typeof t === 'function' ? 'and instance of ' + t.name : t; });\n\t\t\t\tthis.report('must be ' + types.join(' or ') + ', but is ' + _realType(candidate), null, 'type');\n\t\t\t}\n\t\t},\n\t\tuniqueness: function (schema, candidate) {\n\t\t\tif (typeof schema.uniqueness === 'string') { schema.uniqueness = (schema.uniqueness === 'true'); }\n\t\t\tif (typeof schema.uniqueness !== 'boolean' || schema.uniqueness === false || (!_typeIs.array(candidate) && typeof candidate !== 'string')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar reported = [];\n\t\t\tfor (var i = 0; i < candidate.length; i++) {\n\t\t\t\tif (reported.indexOf(candidate[i]) >= 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar indexes = getIndexes(candidate, candidate[i]);\n\t\t\t\tif (indexes.length > 1) {\n\t\t\t\t\treported.push(candidate[i]);\n\t\t\t\t\tthis.report('has value [' + candidate[i] + '] more than once at indexes [' + indexes.join(', ') + ']', null, 'uniqueness');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tpattern: function (schema, candidate) {\n\t\t\tvar self = this;\n\t\t\tvar regexs = schema.pattern;\n\t\t\tif (typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar matches = false;\n\t\t\tif (!_typeIs.array(regexs)) {\n\t\t\t\tregexs = [regexs];\n\t\t\t}\n\t\t\tregexs.forEach(function (regex) {\n\t\t\t\tif (typeof regex === 'string' && regex in _formats) {\n\t\t\t\t\tregex = _formats[regex];\n\t\t\t\t}\n\t\t\t\tif (regex instanceof RegExp) {\n\t\t\t\t\tif (regex.test(candidate)) {\n\t\t\t\t\t\tmatches = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!matches) {\n\t\t\t\tself.report('must match [' + regexs.join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'pattern');\n\t\t\t}\n\t\t},\n\t\tvalidDate: function (schema, candidate) {\n\t\t\tif (String(schema.validDate) === 'true' && candidate instanceof Date && isNaN(candidate.getTime())) {\n\t\t\t\tthis.report('must be a valid date', null, 'validDate');\n\t\t\t}\n\t\t},\n\t\tminLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar minLength = Number(schema.minLength);\n\t\t\tif (isNaN(minLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length < minLength) {\n\t\t\t\tthis.report('must be longer than ' + minLength + ' elements, but it has ' + candidate.length, null, 'minLength');\n\t\t\t}\n\t\t},\n\t\tmaxLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar maxLength = Number(schema.maxLength);\n\t\t\tif (isNaN(maxLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length > maxLength) {\n\t\t\t\tthis.report('must be shorter than ' + maxLength + ' elements, but it has ' + candidate.length, null, 'maxLength');\n\t\t\t}\n\t\t},\n\t\texactLength: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'string' && !_typeIs.array(candidate)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar exactLength = Number(schema.exactLength);\n\t\t\tif (isNaN(exactLength)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate.length !== exactLength) {\n\t\t\t\tthis.report('must have exactly ' + exactLength + ' elements, but it have ' + candidate.length, null, 'exactLength');\n\t\t\t}\n\t\t},\n\t\tlt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate >= limit) {\n\t\t\t\tthis.report('must be less than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lt');\n\t\t\t}\n\t\t},\n\t\tlte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.lte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate > limit) {\n\t\t\t\tthis.report('must be less than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'lte');\n\t\t\t}\n\t\t},\n\t\tgt: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gt);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate <= limit) {\n\t\t\t\tthis.report('must be greater than ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gt');\n\t\t\t}\n\t\t},\n\t\tgte: function (schema, candidate) {\n\t\t\tvar limit = Number(schema.gte);\n\t\t\tif (typeof candidate !== 'number' || isNaN(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (candidate < limit) {\n\t\t\t\tthis.report('must be greater than or equal to ' + limit + ', but is equal to \"' + candidate + '\"', null, 'gte');\n\t\t\t}\n\t\t},\n\t\teq: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string' && typeof candidate !== 'boolean') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.eq;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && typeof limit !== 'boolean' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.report('must be equal to [' + limit.map(function (l) {\n\t\t\t\t\treturn '\"' + l + '\"';\n\t\t\t\t}).join(' or ') + '], but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate !== limit) {\n\t\t\t\t\tthis.report('must be equal to \"' + limit + '\", but is equal to \"' + candidate + '\"', null, 'eq');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tne: function (schema, candidate) {\n\t\t\tif (typeof candidate !== 'number' && typeof candidate !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar limit = schema.ne;\n\t\t\tif (typeof limit !== 'number' && typeof limit !== 'string' && !_typeIs.array(limit)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_typeIs.array(limit)) {\n\t\t\t\tfor (var i = 0; i < limit.length; i++) {\n\t\t\t\t\tif (candidate === limit[i]) {\n\t\t\t\t\t\tthis.report('must not be equal to \"' + limit[i] + '\"', null, 'ne');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (candidate === limit) {\n\t\t\t\t\tthis.report('must not be equal to \"' + limit + '\"', null, 'ne');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsomeKeys: function (schema, candidat) {\n\t\t\tvar _keys = schema.someKeys;\n\t\t\tif (!_typeIs.object(candidat)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar valid = _keys.some(function (action) {\n\t\t\t\treturn (action in candidat);\n\t\t\t});\n\t\t\tif (!valid) {\n\t\t\t\tthis.report('must have at least key ' + _keys.map(function (i) {\n\t\t\t\t\treturn '\"' + i + '\"';\n\t\t\t\t}).join(' or '), null, 'someKeys');\n\t\t\t}\n\t\t},\n\t\tstrict: function (schema, candidate) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true || !_typeIs.object(candidate) || !_typeIs.object(schema.properties)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tif (typeof schema.properties['*'] === 'undefined') {\n\t\t\t\tvar intruder = Object.keys(candidate).filter(function (key) {\n\t\t\t\t\treturn (typeof schema.properties[key] === 'undefined');\n\t\t\t\t});\n\t\t\t\tif (intruder.length > 0) {\n\t\t\t\t\tvar msg = 'should not contains ' + (intruder.length > 1 ? 'properties' : 'property') +\n\t\t\t\t\t\t' [' + intruder.map(function (i) { return '\"' + i + '\"'; }).join(', ') + ']';\n\t\t\t\t\tself.report(msg, null, 'strict');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\texec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, candidate, callback);\n\t\t\t}\n\t\t\t(_typeIs.array(schema.exec) ? schema.exec : [schema.exec]).forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tproperties: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.properties instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar properties = schema.properties,\n\t\t\t\t\ti;\n\t\t\tif (properties['*'] != null) {\n\t\t\t\tfor (i in candidate) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\tthis._validate(properties['*'], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in properties) {\n\t\t\t\tif (i === '*') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._deeperObject(i);\n\t\t\t\tthis._validate(properties[i], candidate[i]);\n\t\t\t\tthis._back();\n\t\t\t}\n\t\t},\n\t\titems: function (schema, candidate, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, candidate, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\t\t\t// If provided schema is an array\n\t\t\t// then call validate for each case\n\t\t\t// else it is an Object\n\t\t\t// then call validate for each key\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tthis._validate(items[i], candidate[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (var key in candidate) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(candidate, key)) {\n\t\t\t\t\t\tthis._deeperArray(key);\n\t\t\t\t\t\tthis._validate(items, candidate[key]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tvar _asyncValidationAttribut = {\n\t\tasyncExec: function (schema, candidate, callback) {\n\t\t\tvar self = this;\n\t\t\tasync.eachSeries(_typeIs.array(schema.exec) ? schema.exec : [schema.exec], function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, candidate, done);\n\t\t\t\t\t}\n\t\t\t\t\texec.call(self, schema, candidate);\n\t\t\t\t}\n\t\t\t\tasync.nextTick(done);\n\t\t\t}, callback);\n\t\t},\n\t\tasyncProperties: function (schema, candidate, callback) {\n\t\t\tif (!(schema.properties instanceof Object) || !_typeIs.object(candidate)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tasync.eachSeries(Object.keys(candidate), function (i, done) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties['*'], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, done) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn async.nextTick(done);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncValidate(properties[i], candidate[i], function (err) {\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tdone(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], callback);\n\t\t},\n\t\tasyncItems: function (schema, candidate, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(candidate instanceof Object)) {\n\t\t\t\treturn callback();\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tvar i, l;\n\n\t\t\tif (_typeIs.array(items) && _typeIs.array(candidate)) {\n\t\t\t\tasync.timesSeries(items.length, function (i, done) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncValidate(items[i], candidate[i], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t\tself._back();\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(candidate), function (key, done) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncValidate(items, candidate[key], function (err, res) {\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tdone(err, res);\n\t\t\t\t\t});\n\t\t\t\t}, callback);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Validation Class ----------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Validation(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Validation.custom, custom));\n\t\tvar _error = [];\n\n\t\tthis._basicFields = Object.keys(_validationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message, code, reason) {\n\t\t\tvar newErr = {\n\t\t\t\tcode: code || this.userCode || null,\n\t\t\t\treason: reason || 'unknown',\n\t\t\t\tmessage: this.userError || message || 'is invalid',\n\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\t_error.push(newErr);\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.result = function () {\n\t\t\treturn {\n\t\t\t\terror: _error,\n\t\t\t\tvalid: _error.length === 0,\n\t\t\t\tformat: function () {\n\t\t\t\t\tif (this.valid === true) {\n\t\t\t\t\t\treturn 'Candidate is valid';\n\t\t\t\t\t}\n\t\t\t\t\treturn this.error.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ': ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Validation.prototype, _validationAttribut);\n\t_extend(Validation.prototype, _asyncValidationAttribut);\n\t_extend(Validation, new Customisable());\n\n\tValidation.prototype.validate = function (candidate, callback) {\n\t\tthis.origin = candidate;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn async.nextTick(function () {\n\t\t\t\tself._asyncValidate(self._schema, candidate, function (err) {\n\t\t\t\t\tself.origin = null;\n\t\t\t\t\tcallback(err, self.result());\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn this._validate(this._schema, candidate).result();\n\t};\n\n\tValidation.prototype._validate = function (schema, candidate, callback) {\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tthis[i](schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tthis._custom[i].call(this, schema, candidate);\n\t\t\t}\n\t\t}, this);\n\t\treturn this;\n\t};\n\n\tValidation.prototype._asyncValidate = function (schema, candidate, callback) {\n\t\tvar self = this;\n\t\tthis.userCode = schema.code || null;\n\t\tthis.userError = schema.error || null;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.series([\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(_validationAttribut), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself[i](schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (next) {\n\t\t\t\tasync.eachSeries(Object.keys(self._custom), function (i, done) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, candidate, done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._custom[i].call(self, schema, candidate);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone();\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n// Sanitization ----------------------------------------------------------------\n\t// functions called by _sanitization.type method.\n\tvar _forceType = {\n\t\tnumber: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseFloat(post.replace(/,/g, '.').replace(/ /g, ''));\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tinteger: function (post, schema) {\n\t\t\tvar n;\n\t\t\tif (typeof post === 'number' && post % 1 === 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse if (post === '') {\n\t\t\t\tif (typeof schema.def !== 'undefined')\n\t\t\t\t\treturn schema.def;\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse if (typeof post === 'string') {\n\t\t\t\tn = parseInt(post.replace(/ /g, ''), 10);\n\t\t\t\tif (typeof n === 'number') {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (typeof post === 'number') {\n\t\t\t\treturn parseInt(post, 10);\n\t\t\t}\n\t\t\telse if (typeof post === 'boolean') {\n\t\t\t\tif (post) { return 1; }\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse if (post instanceof Date) {\n\t\t\t\treturn +post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tstring: function (post, schema) {\n\t\t\tif (typeof post === 'boolean' || typeof post === 'number' || post instanceof Date) {\n\t\t\t\treturn post.toString();\n\t\t\t}\n\t\t\telse if (_typeIs.array(post)) {\n\t\t\t\t// If user authorize array and strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn post.join(String(schema.joinWith || ','));\n\t\t\t}\n\t\t\telse if (post instanceof Object) {\n\t\t\t\t// If user authorize objects ans strings...\n\t\t\t\tif (schema.items || schema.properties)\n\t\t\t\t\treturn post;\n\t\t\t\treturn JSON.stringify(post);\n\t\t\t}\n\t\t\telse if (typeof post === 'string' && post.length) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (post, schema) {\n\t\t\tif (post instanceof Date) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar d = new Date(post);\n\t\t\t\tif (!isNaN(d.getTime())) { // if valid date\n\t\t\t\t\treturn d;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tboolean: function (post, schema) {\n\t\t\tif (typeof post === 'undefined') return null;\n\t\t\tif (typeof post === 'string' && post.toLowerCase() === 'false') return false;\n\t\t\treturn !!post;\n\t\t},\n\t\tobject: function (post, schema) {\n\t\t\tif (typeof post !== 'string' || _typeIs.object(post)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(post);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tarray: function (post, schema) {\n\t\t\tif (_typeIs.array(post))\n\t\t\t\treturn post;\n\t\t\tif (typeof post === 'undefined')\n\t\t\t\treturn null;\n\t\t\tif (typeof post === 'string') {\n\t\t\t\tif (post.substring(0,1) === '[' && post.slice(-1) === ']') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn JSON.parse(post);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn post.split(String(schema.splitWith || ','));\n\n\t\t\t}\n\t\t\tif (!_typeIs.array(post))\n\t\t\t\treturn [ post ];\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tvar _applyRules = {\n\t\tupper: function (post) {\n\t\t\treturn post.toUpperCase();\n\t\t},\n\t\tlower: function (post) {\n\t\t\treturn post.toLowerCase();\n\t\t},\n\t\ttitle: function (post) {\n\t\t\t// Fix by seb (replace \\w\\S* by \\S* => exemple : coucou ça va)\n\t\t\treturn post.replace(/\\S*/g, function (txt) {\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\n\t\t\t});\n\t\t},\n\t\tcapitalize: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1).toLowerCase();\n\t\t},\n\t\tucfirst: function (post) {\n\t\t\treturn post.charAt(0).toUpperCase() + post.substr(1);\n\t\t},\n\t\ttrim: function (post) {\n\t\t\treturn post.trim();\n\t\t}\n\t};\n\n\t// Every function return the future value of each property. Therefore you\n\t// have to return post even if you do not change its value\n\tvar _sanitizationAttribut = {\n\t\tstrict: function (schema, post) {\n\t\t\tif (typeof schema.strict === 'string') { schema.strict = (schema.strict === 'true'); }\n\t\t\tif (schema.strict !== true)\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(schema.properties))\n\t\t\t\treturn post;\n\t\t\tif (!_typeIs.object(post))\n\t\t\t\treturn post;\n\t\t\tvar that = this;\n\t\t\tObject.keys(post).forEach(function (key) {\n\t\t\t\tif (!(key in schema.properties)) {\n\t\t\t\t\tdelete post[key];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn post;\n\t\t},\n\t\toptional: function (schema, post) {\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : (schema.optional !== 'false'); // Default: true\n\t\t\tif (opt === true) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (typeof post !== 'undefined') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tthis.report();\n\t\t\tif (schema.def === Date) {\n\t\t\t\treturn new Date();\n\t\t\t}\n\t\t\treturn schema.def;\n\t\t},\n\t\ttype: function (schema, post) {\n\t\t\t// if (_typeIs['object'](post) || _typeIs.array(post)) {\n\t\t\t// \treturn post;\n\t\t\t// }\n\t\t\tif (typeof schema.type !== 'string' || typeof _forceType[schema.type] !== 'function') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar n;\n\t\t\tvar opt = typeof schema.optional === 'boolean' ? schema.optional : true;\n\t\t\tif (typeof _forceType[schema.type] === 'function') {\n\t\t\t\tn = _forceType[schema.type](post, schema);\n\t\t\t\tif ((n === null && !opt) || (!n && isNaN(n)) || (n === null && schema.type === 'string')) {\n\t\t\t\t\tn = schema.def;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (!opt) {\n\t\t\t\tn = schema.def;\n\t\t\t}\n\t\t\tif ((n != null || (typeof schema.def !== 'undefined' && schema.def === n)) && n !== post) {\n\t\t\t\tthis.report();\n\t\t\t\treturn n;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\trules: function (schema, post) {\n\t\t\tvar rules = schema.rules;\n\t\t\tif (typeof post !== 'string' || (typeof rules !== 'string' && !_typeIs.array(rules))) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar modified = false;\n\t\t\t(_typeIs.array(rules) ? rules : [rules]).forEach(function (rule) {\n\t\t\t\tif (typeof _applyRules[rule] === 'function') {\n\t\t\t\t\tpost = _applyRules[rule](post);\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (modified) {\n\t\t\t\tthis.report();\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmin: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar min = Number(schema.min);\n\t\t\tif (isNaN(min)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest < min) {\n\t\t\t\tthis.report();\n\t\t\t\treturn min;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmax: function (schema, post) {\n\t\t\tvar postTest = Number(post);\n\t\t\tif (isNaN(postTest)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar max = Number(schema.max);\n\t\t\tif (isNaN(max)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (postTest > max) {\n\t\t\t\tthis.report();\n\t\t\t\treturn max;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tminLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.minLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar str = '';\n\t\t\tvar gap = limit - post.length;\n\t\t\tif (gap > 0) {\n\t\t\t\tfor (var i = 0; i < gap; i++) {\n\t\t\t\t\tstr += '-';\n\t\t\t\t}\n\t\t\t\tthis.report();\n\t\t\t\treturn post + str;\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tmaxLength: function (schema, post) {\n\t\t\tvar limit = Number(schema.maxLength);\n\t\t\tif (typeof post !== 'string' || isNaN(limit) || limit < 0) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tif (post.length > limit) {\n\t\t\t\tthis.report();\n\t\t\t\treturn post.slice(0, limit);\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\tproperties: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncProperties(schema, post, callback);\n\t\t\t}\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar properties = schema.properties;\n\t\t\tvar tmp;\n\t\t\tvar i;\n\t\t\tif (typeof properties['*'] !== 'undefined') {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties['*'], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (i in schema.properties) {\n\t\t\t\tif (i !== '*') {\n\t\t\t\t\tthis._deeperObject(i);\n\t\t\t\t\ttmp = this._sanitize(schema.properties[i], post[i]);\n\t\t\t\t\tif (typeof tmp !== 'undefined') {\n\t\t\t\t\t\tpost[i]= tmp;\n\t\t\t\t\t}\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\titems: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncItems(schema, post, callback);\n\t\t\t}\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn post;\n\t\t\t}\n\t\t\tvar i;\n\t\t\tif (_typeIs.array(schema.items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = schema.items.length < post.length ? schema.items.length : post.length;\n\t\t\t\tfor (i = 0; i < minLength; i++) {\n\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\tpost[i] = this._sanitize(schema.items[i], post[i]);\n\t\t\t\t\tthis._back();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (i in post) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(post, i)) {\n\t\t\t\t\t\tthis._deeperArray(i);\n\t\t\t\t\t\tpost[i] = this._sanitize(schema.items, post[i]);\n\t\t\t\t\t\tthis._back();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn post;\n\t\t},\n\t\texec: function (schema, post, callback) {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\treturn this.asyncExec(schema, post, callback);\n\t\t\t}\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\texecs.forEach(function (exec) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tpost = exec.call(this, schema, post);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\treturn post;\n\t\t}\n\t};\n\n\tvar _asyncSanitizationAttribut = {\n\t\tasyncExec: function (schema, post, callback) {\n\t\t\tvar self = this;\n\t\t\tvar execs = _typeIs.array(schema.exec) ? schema.exec : [schema.exec];\n\n\t\t\tasync.eachSeries(execs, function (exec, done) {\n\t\t\t\tif (typeof exec === 'function') {\n\t\t\t\t\tif (exec.length > 2) {\n\t\t\t\t\t\treturn exec.call(self, schema, post, function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn done(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpost = res;\n\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tpost = exec.call(self, schema, post);\n\t\t\t\t}\n\t\t\t\tdone();\n\t\t\t}, function (err) {\n\t\t\t\tcallback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncProperties: function (schema, post, callback) {\n\t\t\tif (!post || typeof post !== 'object') {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar properties = schema.properties;\n\n\t\t\tasync.series([\n\t\t\t\tfunction (next) {\n\t\t\t\t\tif (properties['*'] == null) {\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\t\t\t\tvar globing = properties['*'];\n\t\t\t\t\tasync.eachSeries(Object.keys(post), function (i, next) {\n\t\t\t\t\t\tif (i in properties) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(globing, post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) { /* Error can safely be ignored here */ }\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t},\n\t\t\t\tfunction (next) {\n\t\t\t\t\tasync.eachSeries(Object.keys(properties), function (i, next) {\n\t\t\t\t\t\tif (i === '*') {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself._deeperObject(i);\n\t\t\t\t\t\tself._asyncSanitize(properties[i], post[i], function (err, res) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (typeof res !== 'undefined') {\n\t\t\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself._back();\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t});\n\t\t\t\t\t}, next);\n\t\t\t\t}\n\t\t\t], function (err) {\n\t\t\t\treturn callback(err, post);\n\t\t\t});\n\t\t},\n\t\tasyncItems: function (schema, post, callback) {\n\t\t\tif (!(schema.items instanceof Object) || !(post instanceof Object)) {\n\t\t\t\treturn callback(null, post);\n\t\t\t}\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items;\n\t\t\tif (_typeIs.array(items) && _typeIs.array(post)) {\n\t\t\t\tvar minLength = items.length < post.length ? items.length : post.length;\n\t\t\t\tasync.timesSeries(minLength, function (i, next) {\n\t\t\t\t\tself._deeperArray(i);\n\t\t\t\t\tself._asyncSanitize(items[i], post[i], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[i] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tasync.eachSeries(Object.keys(post), function (key, next) {\n\t\t\t\t\tself._deeperArray(key);\n\t\t\t\t\tself._asyncSanitize(items, post[key], function (err, res) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn next();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpost[key] = res;\n\t\t\t\t\t\tself._back();\n\t\t\t\t\t\tnext();\n\t\t\t\t\t});\n\t\t\t\t}, function (err) {\n\t\t\t\t\tcallback(err, post);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn post;\n\t\t}\n\t};\n\n\t// Sanitization Class --------------------------------------------------------\n\t// inherits from Inspection class (actually we just call Inspection\n\t// constructor with the new context, because its prototype is empty\n\tfunction Sanitization(schema, custom) {\n\t\tInspection.prototype.constructor.call(this, schema, _merge(Sanitization.custom, custom));\n\t\tvar _reporting = [];\n\n\t\tthis._basicFields = Object.keys(_sanitizationAttribut);\n\t\tthis._customFields = Object.keys(this._custom);\n\t\tthis.origin = null;\n\n\t\tthis.report = function (message) {\n\t\t\tvar newNot = {\n\t\t\t\t\tmessage: message || 'was sanitized',\n\t\t\t\t\tproperty: this.userAlias ? (this.userAlias + ' (' + this._dumpStack() + ')') : this._dumpStack()\n\t\t\t};\n\t\t\tif (!_reporting.some(function (e) { return e.property === newNot.property; })) {\n\t\t\t\t_reporting.push(newNot);\n\t\t\t}\n\t\t};\n\n\t\tthis.result = function (data) {\n\t\t\treturn {\n\t\t\t\tdata: data,\n\t\t\t\treporting: _reporting,\n\t\t\t\tformat: function () {\n\t\t\t\t\treturn this.reporting.map(function (i) {\n\t\t\t\t\t\treturn 'Property ' + i.property + ' ' + i.message;\n\t\t\t\t\t}).join('\\n');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n\n\t_extend(Sanitization.prototype, _sanitizationAttribut);\n\t_extend(Sanitization.prototype, _asyncSanitizationAttribut);\n\t_extend(Sanitization, new Customisable());\n\n\n\tSanitization.prototype.sanitize = function (post, callback) {\n\t\tthis.origin = post;\n\t\tif (typeof callback === 'function') {\n\t\t\tvar self = this;\n\t\t\treturn this._asyncSanitize(this._schema, post, function (err, data) {\n\t\t\t\tself.origin = null;\n\t\t\t\tcallback(err, self.result(data));\n\t\t\t});\n\t\t}\n\t\tvar data = this._sanitize(this._schema, post);\n\t\tthis.origin = null;\n\t\treturn this.result(data);\n\t};\n\n\tSanitization.prototype._sanitize = function (schema, post) {\n\t\tthis.userAlias = schema.alias || null;\n\t\tthis._basicFields.forEach(function (i) {\n\t\t\tif ((i in schema || i === 'optional') && typeof this[i] === 'function') {\n\t\t\t\tpost = this[i](schema, post);\n\t\t\t}\n\t\t}, this);\n\t\tthis._customFields.forEach(function (i) {\n\t\t\tif (i in schema && typeof this._custom[i] === 'function') {\n\t\t\t\tpost = this._custom[i].call(this, schema, post);\n\t\t\t}\n\t\t}, this);\n\t\treturn post;\n\t};\n\n\tSanitization.prototype._asyncSanitize = function (schema, post, callback) {\n\t\tvar self = this;\n\t\tthis.userAlias = schema.alias || null;\n\n\t\tasync.waterfall([\n\t\t\tfunction (next) {\n\t\t\t\tasync.reduce(self._basicFields, post, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif ((i in schema || i === 'optional') && typeof self[i] === 'function') {\n\t\t\t\t\t\t\tif (self[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self[i](schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self[i](schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t},\n\t\t\tfunction (inter, next) {\n\t\t\t\tasync.reduce(self._customFields, inter, function (value, i, next) {\n\t\t\t\t\tasync.nextTick(function () {\n\t\t\t\t\t\tif (i in schema && typeof self._custom[i] === 'function') {\n\t\t\t\t\t\t\tif (self._custom[i].length > 2) {\n\t\t\t\t\t\t\t\treturn self._custom[i].call(self, schema, value, next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue = self._custom[i].call(self, schema, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnext(null, value);\n\t\t\t\t\t});\n\t\t\t\t}, next);\n\t\t\t}\n\t\t], callback);\n\t};\n\n\t// ---------------------------------------------------------------------------\n\n\tvar INT_MIN = -2147483648;\n\tvar INT_MAX = 2147483647;\n\n\tvar _rand = {\n\t\tint: function (min, max) {\n\t\t\treturn min + (0 | Math.random() * (max - min + 1));\n\t\t},\n\t\tfloat: function (min, max) {\n\t\t\treturn (Math.random() * (max - min) + min);\n\t\t},\n\t\tbool: function () {\n\t\t\treturn (Math.random() > 0.5);\n\t\t},\n\t\tchar: function (min, max) {\n\t\t\treturn String.fromCharCode(this.int(min, max));\n\t\t},\n\t\tfromList: function (list) {\n\t\t\treturn list[this.int(0, list.length - 1)];\n\t\t}\n\t};\n\n\tvar _formatSample = {\n\t\t'date-time': function () {\n\t\t\treturn new Date().toISOString();\n\t\t},\n\t\t'date': function () {\n\t\t\treturn new Date().toISOString().replace(/T.*$/, '');\n\t\t},\n\t\t'time': function () {\n\t\t\treturn new Date().toLocaleTimeString({}, { hour12: false });\n\t\t},\n\t\t'color': function (min, max) {\n\t\t\tvar s = '#';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('0123456789abcdefABCDEF');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'numeric': function () {\n\t\t\treturn '' + _rand.int(0, INT_MAX);\n\t\t},\n\t\t'integer': function () {\n\t\t\tif (_rand.bool() === true) {\n\t\t\t\treturn '-' + this.numeric();\n\t\t\t}\n\t\t\treturn this.numeric();\n\t\t},\n\t\t'decimal': function () {\n\t\t\treturn this.integer() + '.' + this.numeric();\n\t\t},\n\t\t'alpha': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaNumeric': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'alphaDash': function (min, max) {\n\t\t\tvar s = '';\n\t\t\tif (min < 1) {\n\t\t\t\tmin = 1;\n\t\t\t}\n\t\t\tfor (var i = 0, l = _rand.int(min, max); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_-abcdefghijklmnopqrstuvwxyz_-ABCDEFGHIJKLMNOPQRSTUVWXYZ_-0123456789_-');\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\t'javascript': function (min, max) {\n\t\t\tvar s = _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$');\n\t\t\tfor (var i = 0, l = _rand.int(min, max - 1); i < l; i++) {\n\t\t\t\ts += _rand.fromList('_$abcdefghijklmnopqrstuvwxyz_$ABCDEFGHIJKLMNOPQRSTUVWXYZ_$0123456789_$');\n\t\t\t}\n\t\t\treturn s;\n\t\t}\n\t};\n\n\tfunction _getLimits(schema) {\n\t\tvar min = INT_MIN;\n\t\tvar max = INT_MAX;\n\n\t\tif (schema.gte != null) {\n\t\t\tmin = schema.gte;\n\t\t}\n\t\telse if (schema.gt != null) {\n\t\t\tmin = schema.gt + 1;\n\t\t}\n\t\tif (schema.lte != null) {\n\t\t\tmax = schema.lte;\n\t\t}\n\t\telse if (schema.lt != null) {\n\t\t\tmax = schema.lt - 1;\n\t\t}\n\t\treturn { min: min, max: max };\n\t}\n\n\tvar _typeGenerator = {\n\t\tstring: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar s = '';\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 32;\n\t\t\tif (typeof schema.pattern === 'string' && typeof _formatSample[schema.pattern] === 'function') {\n\t\t\t\treturn _formatSample[schema.pattern](minLength, maxLength);\n\t\t\t}\n\n\t\t\tvar l = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\tfor (var i = 0; i < l; i++) {\n\t\t\t\ts += _rand.char(32, 126);\n\t\t\t}\n\t\t\treturn s;\n\t\t},\n\t\tnumber: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.float(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.float(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tinteger: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\tvar limit = _getLimits(schema);\n\t\t\tvar n = _rand.int(limit.min, limit.max);\n\t\t\tif (schema.ne != null) {\n\t\t\t\tvar ne = _typeIs.array(schema.ne) ? schema.ne : [schema.ne];\n\t\t\t\twhile (ne.indexOf(n) !== -1) {\n\t\t\t\t\tn = _rand.int(limit.min, limit.max);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n;\n\t\t},\n\t\tboolean: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn _rand.bool();\n\t\t},\n\t\t\"null\": function (schema) {\n\t\t\treturn null;\n\t\t},\n\t\tdate: function (schema) {\n\t\t\tif (schema.eq != null) {\n\t\t\t\treturn schema.eq;\n\t\t\t}\n\t\t\treturn new Date();\n\t\t},\n\t\tobject: function (schema) {\n\t\t\tvar o = {};\n\t\t\tvar prop = schema.properties || {};\n\n\t\t\tfor (var key in prop) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(prop, key)) {\n\t\t\t\t\tif (prop[key].optional === true && _rand.bool() === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (key !== '*') {\n\t\t\t\t\t\to[key] = this.generate(prop[key]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar rk = '__random_key_';\n\t\t\t\t\t\tvar randomKey = rk + 0;\n\t\t\t\t\t\tvar n = _rand.int(1, 9);\n\t\t\t\t\t\tfor (var i = 1; i <= n; i++) {\n\t\t\t\t\t\t\tif (!(randomKey in prop)) {\n\t\t\t\t\t\t\t\to[randomKey] = this.generate(prop[key]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trandomKey = rk + i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn o;\n\t\t},\n\t\tarray: function (schema) {\n\t\t\tvar self = this;\n\t\t\tvar items = schema.items || {};\n\t\t\tvar minLength = schema.minLength != null ? schema.minLength : 0;\n\t\t\tvar maxLength = schema.maxLength != null ? schema.maxLength : 16;\n\t\t\tvar type;\n\t\t\tvar candidate;\n\t\t\tvar size;\n\t\t\tvar i;\n\n\t\t\tif (_typeIs.array(items)) {\n\t\t\t\tsize = items.length;\n\t\t\t\tif (schema.exactLength != null) {\n\t\t\t\t\tsize = schema.exactLength;\n\t\t\t\t}\n\t\t\t\telse if (size < minLength) {\n\t\t\t\t\tsize = minLength;\n\t\t\t\t}\n\t\t\t\telse if (size > maxLength) {\n\t\t\t\t\tsize = maxLength;\n\t\t\t\t}\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = null;\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\ttype = items[i].type || 'any';\n\t\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t\t}\n\t\t\t\t\tcandidate[i] = self[type](items[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsize = schema.exactLength != null ? schema.exactLength : _rand.int(minLength, maxLength);\n\t\t\t\tcandidate = new Array(size);\n\t\t\t\ttype = items.type || 'any';\n\t\t\t\tif (_typeIs.array(type)) {\n\t\t\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t\t\t}\n\t\t\t\tfor (i = 0; i < size; i++) {\n\t\t\t\t\tcandidate[i] = self[type](items);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn candidate;\n\t\t},\n\t\tany: function (schema) {\n\t\t\tvar fields = Object.keys(_typeGenerator);\n\t\t\tvar i = fields[_rand.int(0, fields.length - 2)];\n\t\t\treturn this[i](schema);\n\t\t}\n\t};\n\n\t// CandidateGenerator Class (Singleton) --------------------------------------\n\tfunction CandidateGenerator() {\n\t\t// Maybe extends Inspection class too ?\n\t}\n\n\t_extend(CandidateGenerator.prototype, _typeGenerator);\n\n\tvar _instance = null;\n\tCandidateGenerator.instance = function () {\n\t\tif (!(_instance instanceof CandidateGenerator)) {\n\t\t\t_instance = new CandidateGenerator();\n\t\t}\n\t\treturn _instance;\n\t};\n\n\tCandidateGenerator.prototype.generate = function (schema) {\n\t\tvar type = schema.type || 'any';\n\t\tif (_typeIs.array(type)) {\n\t\t\ttype = type[_rand.int(0, type.length - 1)];\n\t\t}\n\t\treturn this[type](schema);\n\t};\n\n// Exports ---------------------------------------------------------------------\n\tvar SchemaInspector = {};\n\n\t// if server-side (node.js) else client-side\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = SchemaInspector;\n\t}\n\telse {\n\t\twindow.SchemaInspector = SchemaInspector;\n\t}\n\n\tSchemaInspector.newSanitization = function (schema, custom) {\n\t\treturn new Sanitization(schema, custom);\n\t};\n\n\tSchemaInspector.newValidation = function (schema, custom) {\n\t\treturn new Validation(schema, custom);\n\t};\n\n\tSchemaInspector.Validation = Validation;\n\tSchemaInspector.Sanitization = Sanitization;\n\n\tSchemaInspector.sanitize = function (schema, post, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Sanitization(schema, custom).sanitize(post, callback);\n\t};\n\n\tSchemaInspector.validate = function (schema, candidate, custom, callback) {\n\t\tif (arguments.length === 3 && typeof custom === 'function') {\n\t\t\tcallback = custom;\n\t\t\tcustom = null;\n\t\t}\n\t\treturn new Validation(schema, custom).validate(candidate, callback);\n\t};\n\n\tSchemaInspector.generate = function (schema, n) {\n\t\tif (typeof n === 'number') {\n\t\t\tvar r = new Array(n);\n\t\t\tfor (var i = 0; i < n; i++) {\n\t\t\t\tr[i] = CandidateGenerator.instance().generate(schema);\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\t\treturn CandidateGenerator.instance().generate(schema);\n\t};\n})();\n"]},"metadata":{},"sourceType":"script"}