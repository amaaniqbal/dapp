{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst config_1 = require(\"../config\");\n/**\n* @ignore\n*/\n\n\nfunction isNameValid(fullyQualifiedName = '') {\n  const NAME_PART_RULE = /^[a-z0-9\\-_+]+$/;\n  const LENGTH_MAX_NAME = 37;\n\n  if (!fullyQualifiedName || fullyQualifiedName.length > LENGTH_MAX_NAME) {\n    return Promise.resolve(false);\n  }\n\n  const nameParts = fullyQualifiedName.split('.');\n\n  if (nameParts.length !== 2) {\n    return Promise.resolve(false);\n  }\n\n  return Promise.resolve(nameParts.reduce((agg, namePart) => {\n    if (!agg) {\n      return false;\n    } else {\n      return NAME_PART_RULE.test(namePart);\n    }\n  }, true));\n}\n/**\n* @ignore\n*/\n\n\nfunction isNamespaceValid(namespaceID) {\n  const NAMESPACE_RULE = /^[a-z0-9\\-_]{1,19}$/;\n  return Promise.resolve(namespaceID.match(NAMESPACE_RULE) !== null);\n}\n/**\n* @ignore\n*/\n\n\nfunction isNameAvailable(fullyQualifiedName) {\n  return config_1.config.network.getNameInfo(fullyQualifiedName).then(() => false).catch(e => {\n    if (e.message === 'Name not found') {\n      return true;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction isNamespaceAvailable(namespaceID) {\n  return config_1.config.network.getNamespaceInfo(namespaceID).then(() => false).catch(e => {\n    if (e.message === 'Namespace not found') {\n      return true;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction ownsName(fullyQualifiedName, ownerAddress) {\n  return config_1.config.network.getNameInfo(fullyQualifiedName).then(nameInfo => nameInfo.address === ownerAddress).catch(e => {\n    if (e.message === 'Name not found') {\n      return false;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction revealedNamespace(namespaceID, revealAddress) {\n  return config_1.config.network.getNamespaceInfo(namespaceID).then(namespaceInfo => namespaceInfo.recipient_address === revealAddress).catch(e => {\n    if (e.message === 'Namespace not found') {\n      return false;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction namespaceIsReady(namespaceID) {\n  return config_1.config.network.getNamespaceInfo(namespaceID).then(namespaceInfo => namespaceInfo.ready).catch(e => {\n    if (e.message === 'Namespace not found') {\n      return false;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction namespaceIsRevealed(namespaceID) {\n  return config_1.config.network.getNamespaceInfo(namespaceID).then(namespaceInfo => !namespaceInfo.ready).catch(e => {\n    if (e.message === 'Namespace not found') {\n      return false;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction isInGracePeriod(fullyQualifiedName) {\n  const network = config_1.config.network;\n  return Promise.all([network.getNameInfo(fullyQualifiedName), network.getBlockHeight(), network.getGracePeriod(fullyQualifiedName)]).then(([nameInfo, blockHeight, gracePeriod]) => {\n    const expiresAt = nameInfo.expire_block;\n    return blockHeight >= expiresAt && blockHeight < gracePeriod + expiresAt;\n  }).catch(e => {\n    if (e.message === 'Name not found') {\n      return false;\n    } else {\n      throw e;\n    }\n  });\n}\n/**\n* @ignore\n*/\n\n\nfunction addressCanReceiveName(address) {\n  return config_1.config.network.getNamesOwned(address).then(names => Promise.all(names.map(name => isNameValid(name))).then(validNames => validNames.filter(nameValid => nameValid).length < 25));\n}\n/**\n* @ignore\n*/\n\n\nfunction isAccountSpendable(address, tokenType, blockHeight) {\n  return config_1.config.network.getAccountStatus(address, tokenType).then(accountStatus => accountStatus.transfer_send_block_id >= blockHeight);\n}\n/**\n* @ignore\n*/\n\n\nexports.safety = {\n  addressCanReceiveName,\n  isInGracePeriod,\n  ownsName,\n  isNameAvailable,\n  isNameValid,\n  isNamespaceValid,\n  isNamespaceAvailable,\n  revealedNamespace,\n  namespaceIsReady,\n  namespaceIsRevealed,\n  isAccountSpendable\n};","map":{"version":3,"sources":["../../src/operations/safety.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = require(\"../config\");\n/**\n* @ignore\n*/\nfunction isNameValid(fullyQualifiedName = '') {\n    const NAME_PART_RULE = /^[a-z0-9\\-_+]+$/;\n    const LENGTH_MAX_NAME = 37;\n    if (!fullyQualifiedName\n        || fullyQualifiedName.length > LENGTH_MAX_NAME) {\n        return Promise.resolve(false);\n    }\n    const nameParts = fullyQualifiedName.split('.');\n    if (nameParts.length !== 2) {\n        return Promise.resolve(false);\n    }\n    return Promise.resolve(nameParts.reduce((agg, namePart) => {\n        if (!agg) {\n            return false;\n        }\n        else {\n            return NAME_PART_RULE.test(namePart);\n        }\n    }, true));\n}\n/**\n* @ignore\n*/\nfunction isNamespaceValid(namespaceID) {\n    const NAMESPACE_RULE = /^[a-z0-9\\-_]{1,19}$/;\n    return Promise.resolve(namespaceID.match(NAMESPACE_RULE) !== null);\n}\n/**\n* @ignore\n*/\nfunction isNameAvailable(fullyQualifiedName) {\n    return config_1.config.network.getNameInfo(fullyQualifiedName)\n        .then(() => false)\n        .catch((e) => {\n        if (e.message === 'Name not found') {\n            return true;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction isNamespaceAvailable(namespaceID) {\n    return config_1.config.network.getNamespaceInfo(namespaceID)\n        .then(() => false)\n        .catch((e) => {\n        if (e.message === 'Namespace not found') {\n            return true;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction ownsName(fullyQualifiedName, ownerAddress) {\n    return config_1.config.network.getNameInfo(fullyQualifiedName)\n        .then(nameInfo => nameInfo.address === ownerAddress)\n        .catch((e) => {\n        if (e.message === 'Name not found') {\n            return false;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction revealedNamespace(namespaceID, revealAddress) {\n    return config_1.config.network.getNamespaceInfo(namespaceID)\n        .then(namespaceInfo => namespaceInfo.recipient_address === revealAddress)\n        .catch((e) => {\n        if (e.message === 'Namespace not found') {\n            return false;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction namespaceIsReady(namespaceID) {\n    return config_1.config.network.getNamespaceInfo(namespaceID)\n        .then(namespaceInfo => namespaceInfo.ready)\n        .catch((e) => {\n        if (e.message === 'Namespace not found') {\n            return false;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction namespaceIsRevealed(namespaceID) {\n    return config_1.config.network.getNamespaceInfo(namespaceID)\n        .then(namespaceInfo => !namespaceInfo.ready)\n        .catch((e) => {\n        if (e.message === 'Namespace not found') {\n            return false;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction isInGracePeriod(fullyQualifiedName) {\n    const network = config_1.config.network;\n    return Promise.all([network.getNameInfo(fullyQualifiedName),\n        network.getBlockHeight(),\n        network.getGracePeriod(fullyQualifiedName)])\n        .then(([nameInfo, blockHeight, gracePeriod]) => {\n        const expiresAt = nameInfo.expire_block;\n        return (blockHeight >= expiresAt) && (blockHeight < (gracePeriod + expiresAt));\n    })\n        .catch((e) => {\n        if (e.message === 'Name not found') {\n            return false;\n        }\n        else {\n            throw e;\n        }\n    });\n}\n/**\n* @ignore\n*/\nfunction addressCanReceiveName(address) {\n    return config_1.config.network.getNamesOwned(address)\n        .then(names => (Promise.all(names.map(name => isNameValid(name)))\n        .then(validNames => validNames.filter(nameValid => nameValid).length < 25)));\n}\n/**\n* @ignore\n*/\nfunction isAccountSpendable(address, tokenType, blockHeight) {\n    return config_1.config.network.getAccountStatus(address, tokenType)\n        .then(accountStatus => accountStatus.transfer_send_block_id >= blockHeight);\n}\n/**\n* @ignore\n*/\nexports.safety = {\n    addressCanReceiveName,\n    isInGracePeriod,\n    ownsName,\n    isNameAvailable,\n    isNameValid,\n    isNamespaceValid,\n    isNamespaceAvailable,\n    revealedNamespace,\n    namespaceIsReady,\n    namespaceIsRevealed,\n    isAccountSpendable\n};\n//# sourceMappingURL=safety.js.map"]},"metadata":{},"sourceType":"script"}